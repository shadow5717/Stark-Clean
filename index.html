<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>STARK CLEANE</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
      :root {
        --primary: #1a73e8;
        --primary-dark: #0d47a1;
        --primary-light: #64b5f6;
        --secondary: #ff6d00;
        --secondary-dark: #e65100;
        --accent: #00c853;
        --danger: #d32f2f;
        --warning: #ffa000;
        --info: #0288d1;
        --dark: #121212;
        --light: #f5f7fb;
        --gray: #5f6368;
        --gray-light: #e8eaed;
        --sidebar-width: 260px;
        --header-height: 70px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      .dark-mode {
        --bg-color: #121212;
        --card-bg: #1e1e1e;
        --text-color: #e0e0e0;
        --text-secondary: #9e9e9e;
        --border-color: #333;
        --hover-color: #2a2a2a;
      }

      .light-mode {
        --bg-color: #f5f7fb;
        --card-bg: #ffffff;
        --text-color: #333333;
        --text-secondary: #5f6368;
        --border-color: #e0e0e0;
        --hover-color: #f8f9fa;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        touch-action: manipulation;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: var(--transition);
        overflow-x: hidden;
        -webkit-tap-highlight-color: transparent;
      }

      .container {
        display: flex;
        min-height: 100vh;
      }

      /* ============================================= */
      /* NUEVOS ESTILOS PARA TOUCH Y DESLIZAMIENTO */
      /* ============================================= */

      .touch-scroll-container {
        display: flex;
        overflow-x: auto;
        padding: 10px 5px 20px 5px;
        gap: 15px;
        scrollbar-width: thin;
        scrollbar-color: var(--primary) transparent;
        -webkit-overflow-scrolling: touch;
        scroll-snap-type: x mandatory;
        margin: 0 -5px;
        width: calc(100% + 10px);
      }

      .touch-scroll-container::-webkit-scrollbar {
        height: 6px;
      }

      .touch-scroll-container::-webkit-scrollbar-track {
        background: transparent;
        border-radius: 10px;
      }

      .touch-scroll-container::-webkit-scrollbar-thumb {
        background: var(--primary);
        border-radius: 10px;
      }

      .touch-scroll-container::-webkit-scrollbar-thumb:hover {
        background: var(--primary-dark);
      }

      .touch-service-card {
        flex: 0 0 auto;
        width: 160px;
        min-height: 140px;
        background: var(--card-bg);
        border-radius: 15px;
        padding: 20px 15px;
        cursor: pointer;
        transition: var(--transition);
        border: 2px solid var(--border-color);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        scroll-snap-align: start;
        box-shadow: var(--shadow);
        user-select: none;
        -webkit-user-select: none;
        position: relative;
        touch-action: pan-y;
      }

      .touch-service-card:active {
        transform: scale(0.98);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .touch-service-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary);
      }

      .touch-service-card.selected {
        border-color: var(--accent);
        background: linear-gradient(
          135deg,
          var(--card-bg),
          rgba(0, 200, 83, 0.1)
        );
        transform: translateY(-3px);
      }

      .touch-service-card i {
        font-size: 2rem;
        margin-bottom: 10px;
        color: var(--primary);
      }

      .touch-service-card h4 {
        font-size: 0.95rem;
        font-weight: 600;
        text-align: center;
        margin-bottom: 5px;
        line-height: 1.2;
      }

      .touch-service-card .price {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--secondary);
        margin-top: 5px;
      }

      .touch-service-card .description {
        font-size: 0.8rem;
        color: var(--text-secondary);
        text-align: center;
        margin-top: 5px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      /* Indicador de scroll para touch */
      .scroll-indicator {
        text-align: center;
        padding: 10px;
        color: var(--text-secondary);
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-bottom: 10px;
      }

      .scroll-indicator i {
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateX(0);
        }
        50% {
          transform: translateX(5px);
        }
      }

      /* Mejoras para dispositivos táctiles */
      @media (hover: none) and (pointer: coarse) {
        .touch-service-card {
          min-height: 130px;
          padding: 15px 12px;
        }

        .touch-service-card h4 {
          font-size: 0.9rem;
        }

        .touch-service-card .price {
          font-size: 1.1rem;
        }
      }

      /* ============================================= */
      /* ESTILOS PARA CIERRE DE CAJA */
      /* ============================================= */

      .cash-closing-container {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 25px;
        margin-top: 20px;
        border: 1px solid var(--border-color);
      }

      .cash-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .cash-method-card {
        background: var(--hover-color);
        border-radius: 10px;
        padding: 20px;
        border-left: 4px solid var(--primary);
      }

      .cash-method-card.efectivo {
        border-left-color: var(--accent);
      }

      .cash-method-card.tarjeta {
        border-left-color: var(--info);
      }

      .cash-method-card.transferencia {
        border-left-color: var(--secondary);
      }

      .cash-method-card h4 {
        font-size: 1rem;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .cash-method-amount {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .cash-method-count {
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .cash-total {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
        border-radius: 10px;
        padding: 25px;
        margin: 25px 0;
        text-align: center;
      }

      .cash-total h3 {
        font-size: 1.2rem;
        margin-bottom: 10px;
        opacity: 0.9;
      }

      .cash-total-amount {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 10px;
      }

      .cash-discrepancy {
        background: rgba(211, 47, 47, 0.1);
        border: 1px solid var(--danger);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
      }

      .cash-discrepancy h4 {
        color: var(--danger);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .discrepancy-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 15px;
      }

      /* ============================================= */
      /* MEJORAS PARA FACTURA 82mm */
      /* ============================================= */

      .invoice-container {
        background: white;
        color: black;
        width: 82mm !important;
        padding: 10px;
        font-family: "Courier New", monospace;
        font-size: 11px !important;
        line-height: 1.1;
        margin: 0 auto;
        min-height: 297mm;
        box-sizing: border-box;
      }

      .invoice-header {
        text-align: center;
        margin-bottom: 8px;
        border-bottom: 2px solid #000;
        padding-bottom: 8px;
      }

      .invoice-logo {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 3px;
      }

      .invoice-company {
        font-weight: bold;
        font-size: 12px;
        margin-bottom: 3px;
      }

      .invoice-address {
        font-size: 9px;
        margin-bottom: 3px;
      }

      .invoice-rnc {
        font-size: 9px;
        margin-bottom: 8px;
      }

      .invoice-details {
        margin-bottom: 8px;
        border-top: 1px dashed #000;
        border-bottom: 1px dashed #000;
        padding: 4px 0;
        font-size: 10px;
      }

      .invoice-items {
        width: 100%;
        margin-bottom: 8px;
        font-size: 10px;
      }

      .invoice-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px;
        border-bottom: 1px dotted #ccc;
        padding-bottom: 3px;
      }

      .invoice-item-name {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 70%;
      }

      .invoice-item-price {
        text-align: right;
        min-width: 30%;
      }

      .invoice-total {
        border-top: 2px solid #000;
        padding-top: 6px;
        margin-bottom: 10px;
        font-weight: bold;
        font-size: 12px;
      }

      .invoice-payment {
        margin-bottom: 10px;
        font-size: 10px;
      }

      .invoice-footer {
        text-align: center;
        border-top: 1px dashed #000;
        padding-top: 8px;
        font-size: 9px;
        margin-top: 10px;
      }

      .invoice-number {
        font-weight: bold;
        margin-top: 5px;
        font-size: 10px;
      }

      /* Card Payment Section para 82mm */
      .card-payment-section {
        margin-top: 15px;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 5px;
        font-family: "Courier New", monospace;
        font-size: 10px !important;
      }

      .card-payment-header {
        text-align: center;
        margin-bottom: 10px;
        font-weight: bold;
        font-size: 11px;
      }

      .card-payment-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 6px;
        margin-bottom: 10px;
        font-size: 10px;
      }

      .card-payment-detail {
        display: flex;
        justify-content: space-between;
      }

      .card-payment-label {
        font-weight: bold;
      }

      .card-payment-approval {
        text-align: center;
        font-size: 12px;
        font-weight: bold;
        color: #00c853;
        margin: 10px 0;
      }

      .card-number {
        letter-spacing: 2px;
        font-weight: bold;
        font-size: 10px;
      }

      @media print {
        body * {
          visibility: hidden;
        }
        .invoice-container,
        .invoice-container * {
          visibility: visible;
        }
        .invoice-container {
          position: absolute;
          left: 0;
          top: 0;
          width: 82mm !important;
          margin: 0;
          padding: 10px;
          box-shadow: none;
        }
        .no-print {
          display: none !important;
        }
      }

      /* ============================================= */
      /* NUEVA SECCIÓN PARA COMANDOS JARVIS PERSONALIZADOS */
      /* ============================================= */

      .jarvis-commands-container {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 25px;
        margin-top: 20px;
        border: 1px solid var(--border-color);
      }

      .command-item {
        background: var(--hover-color);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 4px solid var(--primary);
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
      }

      .command-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
      }

      .command-trigger {
        background: var(--primary);
        color: white;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 500;
      }

      .command-actions {
        display: flex;
        gap: 8px;
      }

      .command-action-btn {
        background: none;
        border: 1px solid var(--border-color);
        color: var(--text-color);
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
      }

      .command-action-btn:hover {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }

      /* ============================================= */
      /* LOGIN MÁS SOFISTICADO */
      /* ============================================= */

      .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(
          135deg,
          var(--primary-dark) 0%,
          var(--primary) 50%,
          var(--secondary) 100%
        );
        padding: 20px;
        position: relative;
        overflow: hidden;
      }

      .login-container::before {
        content: "";
        position: absolute;
        width: 300%;
        height: 300%;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        animation: bgMove 60s linear infinite;
        z-index: 0;
      }

      @keyframes bgMove {
        0% {
          transform: translate(0, 0) rotate(0deg);
        }
        100% {
          transform: translate(-50%, -50%) rotate(360deg);
        }
      }

      .login-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        max-width: 500px;
        position: relative;
        z-index: 1;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 25px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
      }

      .login-header {
        text-align: center;
        margin-bottom: 30px;
        width: 100%;
      }

      .login-logo {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
      }

      .logo-icon-large {
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-radius: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 3rem;
        box-shadow: var(--shadow-lg);
        animation: float 3s ease-in-out infinite;
        border: 5px solid white;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) rotate(0deg);
        }
        50% {
          transform: translateY(-15px) rotate(5deg);
        }
      }

      .login-title {
        font-size: 2.8rem;
        margin-bottom: 10px;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-align: center;
        font-weight: 800;
        letter-spacing: 1px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }

      .login-subtitle {
        color: #666;
        text-align: center;
        margin-bottom: 20px;
        font-size: 1.1rem;
        opacity: 0.9;
        max-width: 600px;
        line-height: 1.5;
      }

      .login-form-container {
        width: 100%;
      }

      .form-tabs {
        display: flex;
        margin-bottom: 25px;
        border-bottom: 2px solid #eee;
      }

      .form-tab {
        flex: 1;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        font-weight: 600;
        color: #666;
        transition: var(--transition);
        position: relative;
      }

      .form-tab.active {
        color: var(--primary);
      }

      .form-tab.active::after {
        content: "";
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 100%;
        height: 3px;
        background: var(--primary);
        border-radius: 3px 3px 0 0;
      }

      .form-content {
        display: none;
        animation: fadeIn 0.5s ease;
      }

      .form-content.active {
        display: block;
      }

      .form-group {
        margin-bottom: 20px;
        position: relative;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .input-with-icon {
        position: relative;
      }

      .input-icon {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #666;
      }

      .form-control {
        width: 100%;
        padding: 15px 15px 15px 45px;
        border: 2px solid #eee;
        border-radius: 12px;
        background: white;
        color: #333;
        transition: var(--transition);
        font-size: 1rem;
        font-weight: 500;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
      }

      .form-control.error {
        border-color: var(--danger);
      }

      .error-message {
        color: var(--danger);
        font-size: 0.85rem;
        margin-top: 5px;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .btn {
        padding: 15px 30px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        font-size: 1rem;
        gap: 8px;
        position: relative;
        overflow: hidden;
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transition: 0.5s;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
      }

      .btn-success {
        background: linear-gradient(135deg, var(--accent), #00a046);
        color: white;
      }

      .btn-custom {
        padding: 16px;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 12px;
        width: 100%;
      }

      .login-footer {
        margin-top: 25px;
        text-align: center;
        color: #666;
        font-size: 0.9rem;
      }

      .login-link {
        color: var(--primary);
        text-decoration: none;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
      }

      .login-link:hover {
        color: var(--primary-dark);
        text-decoration: underline;
      }

      .user-limit-reached {
        background: rgba(211, 47, 47, 0.1);
        border: 1px solid var(--danger);
        color: var(--danger);
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        font-size: 0.95rem;
        margin-top: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .d-none {
        display: none;
      }

      /* ============================================= */
      /* ESTILOS EXISTENTES (MANTENIDOS) */
      /* ============================================= */

      /* Sidebar */
      .sidebar {
        width: var(--sidebar-width);
        background: linear-gradient(
          180deg,
          var(--primary) 0%,
          var(--primary-dark) 100%
        );
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        z-index: 1000;
        transition: var(--transition);
        box-shadow: var(--shadow);
      }

      .sidebar-header {
        padding: 25px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: bold;
        font-size: 1.4rem;
        color: white;
      }

      .logo-icon {
        width: 40px;
        height: 40px;
        background: white;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary);
        font-weight: bold;
        font-size: 1.2rem;
      }

      .sidebar-menu {
        padding: 20px 0;
      }

      .menu-item {
        padding: 14px 20px;
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        transition: var(--transition);
        border-left: 4px solid transparent;
        color: rgba(255, 255, 255, 0.85);
        font-weight: 500;
      }

      .menu-item:hover,
      .menu-item.active {
        background-color: rgba(255, 255, 255, 0.1);
        border-left: 4px solid white;
        color: white;
      }

      .menu-item i {
        width: 20px;
        text-align: center;
        font-size: 1.1rem;
      }

      .submenu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }

      .submenu.active {
        max-height: 300px;
      }

      .submenu-item {
        padding: 12px 20px 12px 60px;
        cursor: pointer;
        transition: var(--transition);
        color: rgba(255, 255, 255, 0.75);
        font-size: 0.9rem;
      }

      .submenu-item:hover {
        background-color: rgba(255, 255, 255, 0.08);
        color: white;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        margin-left: var(--sidebar-width);
        transition: var(--transition);
      }

      .header {
        height: var(--header-height);
        background: var(--card-bg);
        box-shadow: var(--shadow);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 25px;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .hamburger {
        display: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-color);
      }

      .header-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-color);
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .theme-toggle {
        background: none;
        border: none;
        font-size: 1.3rem;
        cursor: pointer;
        color: var(--text-color);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
      }

      .theme-toggle:hover {
        background-color: var(--hover-color);
      }

      .user-profile {
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        padding: 5px 10px;
        border-radius: 20px;
        transition: var(--transition);
      }

      .user-profile:hover {
        background-color: var(--hover-color);
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 1.1rem;
      }

      .user-info {
        display: flex;
        flex-direction: column;
      }

      .user-name {
        font-weight: 500;
        font-size: 0.9rem;
      }

      .user-role {
        font-size: 0.8rem;
        color: var(--text-secondary);
      }

      /* Content Area */
      .content {
        padding: 25px;
      }

      .page-title {
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .page-title h1 {
        font-size: 2rem;
        font-weight: 700;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      /* Dashboard Styles */
      .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
        margin-bottom: 35px;
      }

      .card-system {
        background: var(--card-bg);
        border-radius: 15px;
        box-shadow: var(--shadow);
        padding: 25px;
        transition: var(--transition);
        cursor: pointer;
        border: 1px solid var(--border-color);
        position: relative;
        overflow: hidden;
      }

      .card-system::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
      }

      .card-system:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-lg);
      }

      .card-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        font-size: 1.8rem;
      }

      .barberia {
        background: rgba(26, 115, 232, 0.15);
        color: var(--primary);
      }
      .billar {
        background: rgba(255, 109, 0, 0.15);
        color: var(--secondary);
      }
      .carwash {
        background: rgba(0, 200, 83, 0.15);
        color: var(--accent);
      }
      .config {
        background: rgba(211, 47, 47, 0.15);
        color: var(--danger);
      }

      .card-system h3 {
        font-size: 1.3rem;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .card-system p {
        color: var(--text-secondary);
        font-size: 0.95rem;
        margin-bottom: 15px;
      }

      .card-value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .card-trend {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.9rem;
        font-weight: 500;
      }

      .trend-up {
        color: var(--accent);
      }
      .trend-down {
        color: var(--danger);
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
        margin-bottom: 35px;
      }

      .stat-card {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 25px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border-color);
      }

      .stat-card h3 {
        font-size: 1rem;
        margin-bottom: 15px;
        color: var(--text-secondary);
        font-weight: 500;
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .stat-trend {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.95rem;
        font-weight: 500;
      }

      .chart-container {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 25px;
        box-shadow: var(--shadow);
        margin-top: 25px;
        border: 1px solid var(--border-color);
      }

      .chart-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--text-color);
      }

      /* Page Styles */
      .page {
        display: none;
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .page.active {
        display: block;
      }

      /* Table Styles */
      .table-container {
        background: var(--card-bg);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: var(--shadow);
        margin-top: 20px;
        border: 1px solid var(--border-color);
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 18px 20px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      th {
        background-color: var(--hover-color);
        font-weight: 600;
        color: var(--text-color);
        font-size: 0.95rem;
      }

      tr:hover {
        background-color: var(--hover-color);
      }

      .badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .badge-success {
        background: rgba(0, 200, 83, 0.15);
        color: var(--accent);
      }

      .badge-warning {
        background: rgba(255, 160, 0, 0.15);
        color: var(--warning);
      }

      .badge-danger {
        background: rgba(211, 47, 47, 0.15);
        color: var(--danger);
      }

      .badge-info {
        background: rgba(2, 136, 209, 0.15);
        color: var(--info);
      }

      .action-buttons {
        display: flex;
        gap: 8px;
      }

      .btn-secondary {
        background: var(--secondary);
        color: white;
      }

      .btn-warning {
        background: var(--warning);
        color: white;
      }

      .btn-danger {
        background: var(--danger);
        color: white;
      }

      .btn-outline {
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-color);
      }

      .btn-sm {
        padding: 8px 12px;
        font-size: 0.85rem;
      }

      .btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
        box-shadow: var(--shadow);
      }

      .btn-block {
        width: 100%;
        justify-content: center;
      }

      /* Form Styles */
      .form-container {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 25px;
        box-shadow: var(--shadow);
        margin-top: 20px;
        border: 1px solid var(--border-color);
      }

      label {
        display: block;
        margin-bottom: 10px;
        font-weight: 500;
        color: var(--text-color);
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 14px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        background: var(--bg-color);
        color: var(--text-color);
        transition: var(--transition);
        font-size: 0.95rem;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 30px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--border-color);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
      }

      .modal-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-color);
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-secondary);
        transition: var(--transition);
      }

      .modal-close:hover {
        color: var(--danger);
      }

      /* POS Styles */
      .pos-container {
        display: grid;
        grid-template-columns: 1fr 350px;
        gap: 25px;
      }

      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 18px;
        max-height: 600px;
        overflow-y: auto;
        padding: 10px;
      }

      .product-card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 18px;
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
        border: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .product-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow);
        border-color: var(--primary);
      }

      .product-image {
        width: 80px;
        height: 80px;
        background: var(--hover-color);
        border-radius: 10px;
        margin: 0 auto 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        color: var(--primary);
      }

      .product-card h4 {
        font-size: 1rem;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .product-card p {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--secondary);
      }

      .cart {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 25px;
        box-shadow: var(--shadow);
        height: fit-content;
        border: 1px solid var(--border-color);
      }

      .cart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .cart-title {
        font-size: 1.3rem;
        font-weight: 600;
      }

      .cart-items {
        max-height: 300px;
        overflow-y: auto;
        margin-bottom: 20px;
      }

      .cart-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid var(--border-color);
      }

      .cart-item-info {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .cart-item-name {
        font-weight: 500;
      }

      .cart-item-price {
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .cart-item-actions {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .quantity-btn {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--hover-color);
        border: none;
        cursor: pointer;
        font-weight: bold;
        color: var(--text-color);
      }

      .cart-total {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 20px 0;
        text-align: right;
        color: var(--secondary);
      }

      /* Vehicle Cards */
      .vehicles-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
        margin-top: 20px;
      }

      .vehicle-card {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 25px;
        box-shadow: var(--shadow);
        transition: var(--transition);
        border-left: 5px solid var(--primary);
        border: 1px solid var(--border-color);
      }

      .vehicle-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
      }

      .vehicle-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .vehicle-placa {
        font-size: 1.3rem;
        font-weight: 700;
      }

      .vehicle-type {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .car {
        background: rgba(26, 115, 232, 0.15);
        color: var(--primary);
      }
      .jeepeta {
        background: rgba(255, 109, 0, 0.15);
        color: var(--secondary);
      }
      .motor {
        background: rgba(0, 200, 83, 0.15);
        color: var(--accent);
      }
      .camion {
        background: rgba(211, 47, 47, 0.15);
        color: var(--danger);
      }

      .vehicle-details {
        margin-bottom: 20px;
      }

      .vehicle-detail {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
      }

      .vehicle-time {
        font-size: 0.9rem;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 5px;
      }

      /* Tabs */
      .tabs {
        display: flex;
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 25px;
        overflow-x: auto;
      }

      .tab {
        padding: 14px 24px;
        cursor: pointer;
        transition: var(--transition);
        border-bottom: 3px solid transparent;
        font-weight: 500;
        white-space: nowrap;
      }

      .tab.active {
        border-bottom: 3px solid var(--primary);
        color: var(--primary);
      }

      .tab-content {
        display: none;
        animation: fadeIn 0.5s ease;
      }

      .tab-content.active {
        display: block;
      }

      /* Responsive */
      @media (max-width: 1200px) {
        .sidebar {
          transform: translateX(-100%);
        }
        .sidebar.active {
          transform: translateX(0);
        }
        .main-content {
          margin-left: 0;
        }
        .hamburger {
          display: block;
        }
        .form-row {
          grid-template-columns: 1fr;
        }
        .pos-container {
          grid-template-columns: 1fr;
        }
        .user-info {
          display: none;
        }
      }

      @media (max-width: 768px) {
        .login-wrapper {
          padding: 30px 20px;
          margin: 20px;
        }

        .login-title {
          font-size: 2.2rem;
        }

        .login-subtitle {
          font-size: 1rem;
        }

        .touch-scroll-container {
          gap: 12px;
          padding: 8px 5px 15px 5px;
        }

        .touch-service-card {
          width: 150px;
          min-height: 130px;
        }
      }

      @media (max-width: 480px) {
        .touch-service-card {
          width: 140px;
          min-height: 125px;
          padding: 15px 10px;
        }

        .touch-service-card h4 {
          font-size: 0.85rem;
        }

        .touch-service-card .price {
          font-size: 1rem;
        }
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--bg-color);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--text-secondary);
      }

      /* Notification Styles */
      .notification {
        position: fixed;
        top: 100px;
        right: 25px;
        background: var(--card-bg);
        color: var(--text-color);
        padding: 15px 20px;
        border-radius: 10px;
        box-shadow: var(--shadow-lg);
        border-left: 4px solid var(--accent);
        z-index: 10000;
        animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s;
        max-width: 350px;
      }
      .notification.error {
        border-left-color: var(--danger);
      }
      .notification.warning {
        border-left-color: var(--warning);
      }
      .notification.info {
        border-left-color: var(--info);
      }
      .notification-content {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .notification i {
        font-size: 1.2rem;
      }
      .notification.success i {
        color: var(--accent);
      }
      .notification.error i {
        color: var(--danger);
      }
      .notification.warning i {
        color: var(--warning);
      }
      .notification.info i {
        color: var(--info);
      }
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      /* Alert Badge */
      .alert-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--danger);
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        font-weight: bold;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }

      /* Jarvis AI Styles */
      .jarvis-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 10000;
      }

      .jarvis-btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #1a73e8, #00c853);
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .jarvis-btn.listening {
        background: linear-gradient(135deg, #ff6d00, #d32f2f);
        animation: pulse 1.5s infinite;
      }

      .jarvis-btn:hover {
        transform: scale(1.1);
      }

      .jarvis-chat {
        position: absolute;
        bottom: 80px;
        right: 0;
        width: 350px;
        height: 400px;
        background: var(--card-bg);
        border-radius: 15px;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--border-color);
        display: none;
        flex-direction: column;
        overflow: hidden;
      }

      .jarvis-chat.active {
        display: flex;
      }

      .jarvis-header {
        padding: 15px;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .jarvis-messages {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .message {
        max-width: 80%;
        padding: 10px 15px;
        border-radius: 18px;
        font-size: 0.9rem;
        line-height: 1.4;
      }

      .message.user {
        align-self: flex-end;
        background: var(--primary);
        color: white;
        border-bottom-right-radius: 5px;
      }

      .message.jarvis {
        align-self: flex-start;
        background: var(--hover-color);
        color: var(--text-color);
        border-bottom-left-radius: 5px;
      }

      .jarvis-input {
        padding: 15px;
        border-top: 1px solid var(--border-color);
        display: flex;
        gap: 10px;
      }

      .jarvis-input input {
        flex: 1;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 20px;
        background: var(--bg-color);
        color: var(--text-color);
      }

      .jarvis-input button {
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      /* AI Prediction Cards */
      .ai-prediction {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
      }

      .ai-prediction h4 {
        margin-bottom: 10px;
        font-size: 1rem;
      }

      .ai-prediction p {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      /* Voice Command Key */
      .voice-key {
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 10000;
      }

      .voice-key-btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ff6d00, #d32f2f);
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .voice-key-btn:hover {
        transform: scale(1.1);
      }

      /* RNC Field Styles */
      .rnc-field {
        margin-top: 15px;
        padding: 12px;
        background: var(--hover-color);
        border-radius: 8px;
        border-left: 3px solid var(--info);
      }

      .rnc-field label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
        margin-bottom: 8px;
        color: var(--text-secondary);
      }

      .rnc-input {
        display: flex;
        gap: 10px;
      }

      .rnc-input input {
        flex: 1;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background: var(--card-bg);
        color: var(--text-color);
        font-size: 0.9rem;
      }

      .rnc-optional {
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-top: 5px;
        display: block;
      }

      /* Approval Field */
      .approval-field {
        margin-top: 15px;
        padding: 12px;
        background: var(--hover-color);
        border-radius: 8px;
        border-left: 3px solid var(--warning);
      }

      .approval-field label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
        margin-bottom: 8px;
        color: var(--text-color);
        font-weight: 500;
      }

      .approval-input {
        display: flex;
        gap: 10px;
      }

      .approval-input input {
        flex: 1;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background: var(--card-bg);
        color: var(--text-color);
        font-size: 0.9rem;
      }

      /* Configuration Styles */
      .config-tabs {
        display: flex;
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 25px;
        overflow-x: auto;
      }

      .config-tab {
        padding: 14px 24px;
        cursor: pointer;
        transition: var(--transition);
        border-bottom: 3px solid transparent;
        font-weight: 500;
        white-space: nowrap;
      }

      .config-tab.active {
        border-bottom: 3px solid var(--primary);
        color: var(--primary);
      }

      .config-section {
        margin-bottom: 30px;
        padding: 20px;
        background: var(--card-bg);
        border-radius: 12px;
        border: 1px solid var(--border-color);
      }

      /* Product Search */
      .product-search {
        margin-bottom: 20px;
      }

      .product-search input {
        width: 100%;
        padding: 12px 20px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        background: var(--card-bg);
        color: var(--text-color);
      }

      /* Client List */
      .clients-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .client-card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid var(--border-color);
      }

      .client-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .client-name {
        font-weight: 600;
        font-size: 1.1rem;
      }

      .client-phone {
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      .client-services {
        margin-top: 10px;
      }

      .service-tag {
        display: inline-block;
        background: rgba(26, 115, 232, 0.1);
        color: var(--primary);
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        margin-right: 5px;
        margin-bottom: 5px;
      }

      /* Payment Validation */
      .payment-validation {
        background: rgba(211, 47, 47, 0.1);
        border: 1px solid var(--danger);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
        color: var(--danger);
        display: none;
      }

      .payment-validation.show {
        display: block;
      }

      /* Employee Management */
      .employees-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .employee-card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid var(--border-color);
      }

      .employee-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
      }

      .employee-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 1.2rem;
      }

      /* Printer Configuration */
      .printer-options {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .printer-option {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 15px;
        cursor: pointer;
        transition: var(--transition);
      }

      .printer-option:hover {
        border-color: var(--primary);
        transform: translateY(-3px);
      }

      .printer-option.active {
        border-color: var(--primary);
        background: rgba(26, 115, 232, 0.1);
      }
    </style>
  </head>
  <body class="dark-mode">
    <!-- Login Screen Mejorado -->
    <div class="login-container" id="screen-login">
      <div class="login-wrapper">
        <div class="login-header">
          <div class="login-logo">
            <div class="logo-icon-large">SC</div>
            <h1 class="login-title">STARK CLEANE</h1>
            <p class="login-subtitle">
              Sistema Inteligente de Gestión Empresarial
            </p>
          </div>
        </div>

        <div class="login-form-container">
          <div class="form-tabs">
            <div class="form-tab active" id="loginTab">Iniciar Sesión</div>
            <div class="form-tab" id="registerTab">Registrarse</div>
          </div>

          <!-- Formulario de Login -->
          <div class="form-content active" id="loginForm">
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-user"></i> Usuario
              </label>
              <div class="input-with-icon">
                <i class="fas fa-user input-icon"></i>
                <input
                  type="text"
                  id="login-username"
                  class="form-control"
                  placeholder="Ingrese su usuario"
                />
              </div>
              <div class="error-message d-none" id="loginUserError">
                <i class="fas fa-exclamation-circle"></i> El usuario es
                requerido
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-lock"></i> Contraseña
              </label>
              <div class="input-with-icon">
                <i class="fas fa-lock input-icon"></i>
                <input
                  type="password"
                  id="login-password"
                  class="form-control"
                  placeholder="Ingrese su contraseña"
                />
              </div>
              <div class="error-message d-none" id="loginPassError">
                <i class="fas fa-exclamation-circle"></i> La contraseña es
                requerida
              </div>
            </div>

            <div class="form-group">
              <button id="btn-login" class="btn btn-primary btn-custom">
                <i class="fas fa-sign-in-alt"></i> Entrar al Sistema
              </button>
            </div>
          </div>

          <!-- Formulario de Registro -->
          <div class="form-content" id="registerForm">
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-user-plus"></i> Nuevo Usuario
              </label>
              <div class="input-with-icon">
                <i class="fas fa-user input-icon"></i>
                <input
                  type="text"
                  id="register-username"
                  class="form-control"
                  placeholder="Nombre de usuario"
                />
              </div>
              <div class="error-message d-none" id="registerUserError">
                <i class="fas fa-exclamation-circle"></i> El usuario es
                requerido
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-lock"></i> Contraseña (6+ caracteres)
              </label>
              <div class="input-with-icon">
                <i class="fas fa-lock input-icon"></i>
                <input
                  type="password"
                  id="register-password"
                  class="form-control"
                  placeholder="Contraseña segura"
                />
              </div>
              <div class="error-message d-none" id="registerPassError">
                <i class="fas fa-exclamation-circle"></i> Mínimo 6 caracteres
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-lock"></i> Confirmar Contraseña
              </label>
              <div class="input-with-icon">
                <i class="fas fa-lock input-icon"></i>
                <input
                  type="password"
                  id="register-confirm-password"
                  class="form-control"
                  placeholder="Repita la contraseña"
                />
              </div>
              <div class="error-message d-none" id="registerConfirmError">
                <i class="fas fa-exclamation-circle"></i> Las contraseñas no
                coinciden
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-user-tag"></i> Rol de Usuario
              </label>
              <select id="register-role" class="form-control">
                <option value="vendedor">Vendedor</option>
                <option value="admin">Administrador</option>
              </select>
            </div>

            <div class="form-group">
              <button id="btn-register" class="btn btn-success btn-custom">
                <i class="fas fa-user-plus"></i> Crear Cuenta
              </button>
            </div>

            <div id="user-limit-message" class="user-limit-reached d-none">
              <i class="fas fa-exclamation-circle"></i>
              Límite de usuarios alcanzado (máximo 3)
            </div>
          </div>

          <div class="login-footer">
            <p>
              ¿Necesitas ayuda?
              <a href="mailto:Studiosstark@gmail.com" class="login-link"
                >Contactar Soporte</a
              >
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Main System (Hidden until login) -->
    <div class="container" id="mainSystem" style="display: none">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-header">
          <div class="logo">
            <div class="logo-icon">SC</div>
            <span>STARK CLEANE</span>
          </div>
        </div>
        <div class="sidebar-menu">
          <div class="menu-item active" data-page="dashboard">
            <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
          </div>
          <div class="menu-item" data-page="barberia">
            <i class="fas fa-cut"></i>
            <span>Barbería</span>
          </div>

          <div class="menu-item" data-page="billar">
            <i class="fas fa-dice"></i>
            <span>Billar</span>
          </div>

          <div class="menu-item" data-page="carwash">
            <i class="fas fa-car"></i>
            <span>Car Wash</span>
          </div>

          <div class="menu-item" data-submenu="configuracion">
            <i class="fas fa-cog"></i>
            <span>Configuración</span>
            <i class="fas fa-chevron-down ml-auto"></i>
          </div>
          <div class="submenu" id="configuracion-submenu">
            <div class="submenu-item" data-page="config-usuarios">Usuarios</div>
            <div class="submenu-item" data-page="config-servicios">
              Servicios
            </div>
            <div class="submenu-item" data-page="config-productos">
              Productos
            </div>
            <div class="submenu-item" data-page="config-empleados">
              Empleados
            </div>
            <div class="submenu-item" data-page="config-impresora">
              Impresora
            </div>
            <div class="submenu-item" data-page="config-tema">Tema</div>
            <div class="submenu-item" data-page="config-jarvis">
              Configuración Jarvis
            </div>
            <div class="submenu-item" data-page="config-cierre">
              Cierre de Caja
            </div>
            <div class="submenu-item" data-page="config-contabilidad">
              Contabilidad
            </div>
          </div>

          <div class="menu-item" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i>
            <span>Cerrar Sesión</span>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <div class="header">
          <div class="header-left">
            <div class="hamburger">
              <i class="fas fa-bars"></i>
            </div>
            <div class="header-title" id="headerTitle">Dashboard</div>
          </div>
          <div class="header-actions">
            <button class="theme-toggle" id="themeToggle">
              <i class="fas fa-moon"></i>
            </button>
            <div class="user-profile">
              <div class="user-avatar" id="userAvatar">U</div>
              <div class="user-info">
                <div class="user-name" id="currentUserName">Usuario</div>
                <div class="user-role" id="currentUserRole">Rol</div>
              </div>
            </div>
          </div>
        </div>

        <div class="content">
          <!-- Dashboard -->
          <div class="page active" id="dashboard">
            <div class="page-title">
              <h1>Dashboard Principal</h1>
              <div class="header-actions">
                <button class="btn btn-outline" id="refreshDashboard">
                  <i class="fas fa-sync-alt"></i> Actualizar
                </button>
              </div>
            </div>

            <!-- AI Predictions -->
            <div class="ai-prediction">
              <h4>
                <i class="fas fa-robot"></i> PREDICCIÓN INTELIGENTE - JARVIS
              </h4>
              <p id="aiPredictionText">
                Bienvenido al sistema STARK CLEANE. Comienza configurando tus
                servicios en la sección de Configuración.
              </p>
            </div>

            <!-- Alertas en tiempo real -->
            <div id="liveAlerts"></div>

            <div class="dashboard-cards">
              <div class="card-system" data-page="barberia">
                <div class="card-icon barberia">
                  <i class="fas fa-cut"></i>
                </div>
                <h3>Barbería</h3>
                <p>Gestión de citas y clientes</p>
                <div class="card-value" id="appointmentsCount">0</div>
                <div class="card-trend">
                  <span id="appointmentsTrend">No hay citas hoy</span>
                </div>
              </div>

              <div class="card-system" data-page="billar">
                <div class="card-icon billar">
                  <i class="fas fa-dice"></i>
                </div>
                <h3>Billar</h3>
                <p>Punto de venta e inventario</p>
                <div class="card-value" id="salesTotal">RD$ 0</div>
                <div class="card-trend">
                  <span id="salesTrend">No hay ventas hoy</span>
                </div>
              </div>

              <div class="card-system" data-page="carwash">
                <div class="card-icon carwash">
                  <i class="fas fa-car"></i>
                </div>
                <h3>Car Wash</h3>
                <p>Lavado de vehículos</p>
                <div class="card-value" id="vehiclesCount">0</div>
                <div class="card-trend">
                  <span id="vehiclesTrend">No hay vehículos hoy</span>
                </div>
              </div>

              <div class="card-system" data-page="config-cierre">
                <div class="card-icon config">
                  <i class="fas fa-cash-register"></i>
                </div>
                <h3>Cierre de Caja</h3>
                <p>Cierre diario y reportes</p>
                <div class="card-value" id="cashCount">0</div>
                <div class="card-trend">
                  <span>Gestionar cierre</span>
                </div>
              </div>
            </div>

            <div class="stats">
              <div class="stat-card">
                <h3>Ingresos de Hoy</h3>
                <div class="stat-value" id="dailyIncome">RD$ 0</div>
                <div class="stat-trend">
                  <span id="incomeTrend">Sin ingresos hoy</span>
                </div>
              </div>

              <div class="stat-card">
                <h3>Clientes Atendidos</h3>
                <div class="stat-value" id="customersCount">0</div>
                <div class="stat-trend">
                  <span id="customersTrend">Sin clientes hoy</span>
                </div>
              </div>

              <div class="stat-card">
                <h3>Productos Vendidos</h3>
                <div class="stat-value" id="productsSold">0</div>
                <div class="stat-trend">
                  <span id="productsTrend">Sin productos vendidos</span>
                </div>
              </div>
            </div>

            <div class="chart-container">
              <div class="chart-title">Actividad Reciente</div>
              <canvas id="salesChart"></canvas>
            </div>
          </div>

          <!-- Barbería - Página Completa -->
          <div class="page" id="barberia">
            <div class="page-title">
              <h1>Barbería</h1>
              <button class="btn btn-primary" id="newAppointmentBtn">
                <i class="fas fa-plus"></i> Nueva Cita
              </button>
            </div>

            <!-- Tabs de Barbería -->
            <div class="tabs">
              <div class="tab active" data-tab="barberia-venta">
                Venta de Servicios
              </div>
              <div class="tab" data-tab="barberia-citas">Registro de Citas</div>
              <div class="tab" data-tab="barberia-clientes">
                Clientes Registrados
              </div>
              <div class="tab" data-tab="barberia-historial">
                Historial de Ventas
              </div>
            </div>

            <!-- Contenido de las Tabs -->
            <div class="tab-content active" id="barberia-venta">
              <!-- Servicios de Barbería con scroll táctil y deslizamiento -->
              <div class="page-title" style="margin-bottom: 10px">
                <h3>Servicios de Barbería</h3>
                <small style="color: var(--text-secondary)"
                  >Arrastra para reordenar los servicios</small
                >
              </div>
              <div class="scroll-indicator">
                <i class="fas fa-arrows-alt"></i>
                <span
                  >Desliza para ver más servicios - Arrastra para
                  reordenar</span
                >
              </div>
              <div class="touch-scroll-container" id="barberia-touch-container">
                <!-- Los servicios se cargarán dinámicamente -->
              </div>

              <div class="pos-container">
                <div>
                  <div class="form-group">
                    <label for="cliente-barberia"
                      ><i class="fas fa-user"></i> Cliente (Opcional)</label
                    >
                    <input
                      type="text"
                      id="cliente-barberia"
                      placeholder="Nombre del cliente"
                    />
                  </div>
                </div>

                <!-- Carrito de Venta Barbería - CON RNC -->
                <div class="cart">
                  <div class="cart-header">
                    <div class="cart-title">Carrito de Venta</div>
                    <div class="badge badge-info" id="cartCountBarberia">
                      0 servicios
                    </div>
                  </div>

                  <div class="cart-items" id="cartItemsBarberia">
                    <!-- Los servicios del carrito se cargarán dinámicamente -->
                  </div>

                  <div class="cart-total" id="cartTotalBarberia">
                    Total: RD$ 0
                  </div>

                  <!-- Campo RNC Opcional -->
                  <div class="rnc-field">
                    <label for="rnc-barberia">
                      <i class="fas fa-id-card"></i> RNC (Opcional para factura)
                      <span class="rnc-optional"
                        >Dejar vacío para "Consumidor Final"</span
                      >
                    </label>
                    <div class="rnc-input">
                      <input
                        type="text"
                        id="rnc-barberia"
                        placeholder="Ej: 133577461"
                        maxlength="11"
                        value="133577461"
                      />
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="metodo-pago-barberia">Método de Pago</label>
                    <select id="metodo-pago-barberia">
                      <option value="efectivo">Efectivo</option>
                      <option value="tarjeta">Tarjeta</option>
                      <option value="transferencia">Transferencia</option>
                    </select>
                  </div>

                  <!-- Campo de aprobación para tarjeta -->
                  <div
                    class="approval-field"
                    id="approvalFieldBarberia"
                    style="display: none"
                  >
                    <label for="aprobacion-barberia">
                      <i class="fas fa-credit-card"></i> Aprobación de Tarjeta /
                      Comprobante
                      <span class="rnc-optional"
                        >Número de aprobación o comprobante</span
                      >
                    </label>
                    <div class="approval-input">
                      <input
                        type="text"
                        id="aprobacion-barberia"
                        placeholder="Ej: 123456"
                      />
                    </div>
                  </div>

                  <div class="form-group" id="cashPaymentSectionBarberia">
                    <label for="efectivo-recibido-barberia"
                      >Efectivo Recibido</label
                    >
                    <input
                      type="number"
                      id="efectivo-recibido-barberia"
                      placeholder="RD$"
                      value="0"
                    />
                    <div
                      id="cambio-display-barberia"
                      style="
                        margin-top: 10px;
                        font-weight: bold;
                        color: var(--accent);
                      "
                    >
                      Cambio: RD$ 0
                    </div>
                  </div>

                  <div
                    class="payment-validation"
                    id="paymentValidationBarberia"
                  >
                    <i class="fas fa-exclamation-circle"></i> El efectivo
                    recibido es menor al total. Verifique el pago.
                  </div>

                  <button
                    class="btn btn-primary btn-block"
                    id="printTicketBtnBarberia"
                  >
                    <i class="fas fa-print"></i> Imprimir Ticket
                  </button>
                  <button
                    class="btn btn-success btn-block"
                    id="confirmSaleBtnBarberia"
                  >
                    <i class="fas fa-check"></i> Confirmar Venta
                  </button>
                </div>
              </div>
            </div>

            <div class="tab-content" id="barberia-citas">
              <div class="form-container">
                <h3>Registrar Nueva Cita</h3>
                <div class="form-row">
                  <div class="form-group">
                    <label for="cliente-cita"
                      ><i class="fas fa-user"></i> Nombre del Cliente</label
                    >
                    <input
                      type="text"
                      id="cliente-cita"
                      placeholder="Nombre completo"
                    />
                  </div>
                  <div class="form-group">
                    <label for="telefono-cita"
                      ><i class="fas fa-phone"></i> Teléfono</label
                    >
                    <input
                      type="text"
                      id="telefono-cita"
                      placeholder="Teléfono"
                    />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="servicio-cita"
                      ><i class="fas fa-cut"></i> Servicio</label
                    >
                    <select id="servicio-cita">
                      <!-- Se cargarán dinámicamente -->
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="barbero-cita"
                      ><i class="fas fa-user-tie"></i> Barbero</label
                    >
                    <select id="barbero-cita">
                      <!-- Se cargarán dinámicamente -->
                    </select>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="fecha-cita"
                      ><i class="fas fa-calendar"></i> Fecha</label
                    >
                    <input type="date" id="fecha-cita" />
                  </div>
                  <div class="form-group">
                    <label for="hora-cita"
                      ><i class="fas fa-clock"></i> Hora</label
                    >
                    <input type="time" id="hora-cita" />
                  </div>
                </div>
                <div class="form-group">
                  <label for="notas-cita"
                    ><i class="fas fa-sticky-note"></i> Notas (Opcional)</label
                  >
                  <textarea
                    id="notas-cita"
                    rows="3"
                    placeholder="Notas adicionales"
                  ></textarea>
                </div>
                <button class="btn btn-primary" id="saveAppointmentBtn">
                  <i class="fas fa-save"></i> Guardar Cita
                </button>
              </div>

              <!-- Tabla de Citas Programadas -->
              <div class="table-container" style="margin-top: 30px">
                <h3>Citas Programadas</h3>
                <table>
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Hora</th>
                      <th>Cliente</th>
                      <th>Servicio</th>
                      <th>Barbero</th>
                      <th>Estado</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="appointmentsTable">
                    <!-- Las citas se cargarán dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>

            <div class="tab-content" id="barberia-clientes">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Cliente</th>
                      <th>Teléfono</th>
                      <th>Última Visita</th>
                      <th>Total Gastado</th>
                      <th>Servicios</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="clientsTable">
                    <!-- Los clientes se cargarán dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>

            <div class="tab-content" id="barberia-historial">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Cliente</th>
                      <th>Servicios</th>
                      <th>Total</th>
                      <th>Método Pago</th>
                      <th>RNC</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="barberiaHistoryTable">
                    <!-- El historial se cargará dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Billar - Página Completa -->
          <div class="page" id="billar">
            <div class="page-title">
              <h1>Billar - Sistema POS</h1>
              <button class="btn btn-primary" id="newProductBtn">
                <i class="fas fa-plus"></i> Nuevo Producto
              </button>
            </div>

            <!-- Tabs de Billar -->
            <div class="tabs">
              <div class="tab active" data-tab="billar-inventario">
                Inventario
              </div>
              <div class="tab" data-tab="billar-pos">Punto de Venta</div>
              <div class="tab" data-tab="billar-ventas">Ventas del Día</div>
              <div class="tab" data-tab="billar-reportes">Reportes</div>
            </div>

            <!-- Contenido de las Tabs -->
            <div class="tab-content active" id="billar-inventario">
              <div class="page-title">
                <h2>Inventario de Productos</h2>
                <div class="header-actions">
                  <button class="btn btn-outline" id="exportProductsBtn">
                    <i class="fas fa-file-export"></i> Exportar
                  </button>
                  <button class="btn btn-primary" id="addProductBtn">
                    <i class="fas fa-plus"></i> Agregar Producto
                  </button>
                </div>
              </div>

              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Código</th>
                      <th>Producto</th>
                      <th>Categoría</th>
                      <th>P. Compra</th>
                      <th>P. Venta</th>
                      <th>Stock</th>
                      <th>Estado</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="productsTable">
                    <!-- Los productos se cargarán dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>

            <div class="tab-content" id="billar-pos">
              <div class="page-title">
                <h2>Punto de Venta</h2>
                <div class="header-actions">
                  <button class="btn btn-outline" id="clearCartBtn">
                    <i class="fas fa-trash"></i> Limpiar Carrito
                  </button>
                </div>
              </div>

              <div class="pos-container">
                <div>
                  <div class="form-group product-search">
                    <label for="search-product"
                      ><i class="fas fa-search"></i> Buscar Producto</label
                    >
                    <input
                      type="text"
                      id="search-product"
                      placeholder="Escriba nombre, código o categoría"
                    />
                  </div>

                  <h3>Productos Disponibles</h3>
                  <div class="scroll-indicator">
                    <i class="fas fa-arrows-alt"></i>
                    <span
                      >Desliza para ver más productos - Arrastra para
                      reordenar</span
                    >
                  </div>
                  <div
                    class="touch-scroll-container"
                    id="billar-products-touch"
                  >
                    <!-- Los productos se cargarán dinámicamente -->
                  </div>
                </div>

                <!-- Carrito de Venta - CON RNC -->
                <div class="cart">
                  <div class="cart-header">
                    <div class="cart-title">Carrito de Venta</div>
                    <div class="badge badge-info" id="cartCount">
                      0 productos
                    </div>
                  </div>

                  <div class="cart-items" id="cartItems">
                    <!-- Los productos del carrito se cargarán dinámicamente -->
                  </div>

                  <div class="cart-total" id="cartTotal">Total: RD$ 0</div>

                  <!-- Campo RNC Opcional -->
                  <div class="rnc-field">
                    <label for="rnc">
                      <i class="fas fa-id-card"></i> RNC (Opcional para factura)
                      <span class="rnc-optional"
                        >Dejar vacío para "Consumidor Final"</span
                      >
                    </label>
                    <div class="rnc-input">
                      <input
                        type="text"
                        id="rnc"
                        placeholder="Ej: 133577461"
                        maxlength="11"
                        value="133577461"
                      />
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="metodo-pago">Método de Pago</label>
                    <select id="metodo-pago">
                      <option value="efectivo">Efectivo</option>
                      <option value="tarjeta">Tarjeta</option>
                      <option value="transferencia">Transferencia</option>
                    </select>
                  </div>

                  <!-- Campo de aprobación para tarjeta -->
                  <div
                    class="approval-field"
                    id="approvalField"
                    style="display: none"
                  >
                    <label for="aprobacion">
                      <i class="fas fa-credit-card"></i> Aprobación de Tarjeta /
                      Comprobante
                      <span class="rnc-optional"
                        >Número de aprobación o comprobante</span
                      >
                    </label>
                    <div class="approval-input">
                      <input
                        type="text"
                        id="aprobacion"
                        placeholder="Ej: 123456"
                      />
                    </div>
                  </div>

                  <div class="form-group" id="cashPaymentSection">
                    <label for="efectivo-recibido">Efectivo Recibido</label>
                    <input
                      type="number"
                      id="efectivo-recibido"
                      placeholder="RD$"
                      value="0"
                    />
                    <div
                      id="cambio-display"
                      style="
                        margin-top: 10px;
                        font-weight: bold;
                        color: var(--accent);
                      "
                    >
                      Cambio: RD$ 0
                    </div>
                  </div>

                  <div class="payment-validation" id="paymentValidation">
                    <i class="fas fa-exclamation-circle"></i> El efectivo
                    recibido es menor al total. Verifique el pago.
                  </div>

                  <button class="btn btn-primary btn-block" id="printTicketBtn">
                    <i class="fas fa-print"></i> Imprimir Ticket
                  </button>
                  <button class="btn btn-success btn-block" id="confirmSaleBtn">
                    <i class="fas fa-check"></i> Confirmar Venta
                  </button>
                </div>
              </div>
            </div>

            <div class="tab-content" id="billar-ventas">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Hora</th>
                      <th>Total</th>
                      <th>Productos Vendidos</th>
                      <th>Método de Pago</th>
                      <th>RNC</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="salesTable">
                    <!-- Las ventas se cargarán dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>

            <div class="tab-content" id="billar-reportes">
              <div class="page-title">
                <h2>Reportes</h2>
                <div class="header-actions">
                  <button class="btn btn-success" id="exportExcelBtn">
                    <i class="fas fa-file-excel"></i> Exportar a Excel
                  </button>
                  <button class="btn btn-danger" id="exportPdfBtn">
                    <i class="fas fa-file-pdf"></i> Exportar a PDF
                  </button>
                </div>
              </div>

              <div class="form-container">
                <div class="form-row">
                  <div class="form-group">
                    <label for="fecha-inicio">Fecha Inicio</label>
                    <input type="date" id="fecha-inicio" />
                  </div>
                  <div class="form-group">
                    <label for="fecha-fin">Fecha Fin</label>
                    <input type="date" id="fecha-fin" />
                  </div>
                </div>

                <button class="btn btn-primary" id="generateReportBtn">
                  <i class="fas fa-chart-bar"></i> Generar Reporte
                </button>
              </div>

              <div class="stats" style="margin-top: 20px">
                <div class="stat-card">
                  <h3>Total Vendido</h3>
                  <div class="stat-value" id="totalSold">RD$ 0</div>
                  <div class="stat-trend">
                    <span id="soldTrend">Sin ventas registradas</span>
                  </div>
                </div>

                <div class="stat-card">
                  <h3>Producto Más Vendido</h3>
                  <div class="stat-value" id="topProduct">N/A</div>
                  <div class="stat-trend">
                    <span id="topProductCount">0 unidades</span>
                  </div>
                </div>

                <div class="stat-card">
                  <h3>Categoría Más Popular</h3>
                  <div class="stat-value" id="topCategory">N/A</div>
                  <div class="stat-trend">
                    <span id="topCategoryPercent">0% de las ventas</span>
                  </div>
                </div>
              </div>

              <div class="chart-container">
                <div class="chart-title">Ventas por Categoría</div>
                <canvas id="categoryChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Car Wash - Página Completa -->
          <div class="page" id="carwash">
            <div class="page-title">
              <h1>Car Wash</h1>
              <button class="btn btn-success" id="newVehicleBtn">
                <i class="fas fa-plus"></i> Registrar Vehículo
              </button>
            </div>

            <!-- Tabs de Car Wash -->
            <div class="tabs">
              <div class="tab active" data-tab="carwash-registro">
                Registro de Vehículos
              </div>
              <div class="tab" data-tab="carwash-proceso">
                Vehículos en Proceso
              </div>
              <div class="tab" data-tab="carwash-entregados">
                Vehículos Entregados
              </div>
              <div class="tab" data-tab="carwash-servicios">Servicios</div>
              <div class="tab" data-tab="carwash-historial">Historial</div>
            </div>

            <!-- Contenido de las Tabs -->
            <div class="tab-content active" id="carwash-registro">
              <div class="form-container">
                <h3>Registrar Nuevo Vehículo</h3>
                <div class="form-row">
                  <div class="form-group">
                    <label for="placa-vehiculo"
                      ><i class="fas fa-car"></i> Placa del Vehículo</label
                    >
                    <input
                      type="text"
                      id="placa-vehiculo"
                      placeholder="Ej: ABC123"
                    />
                  </div>
                  <div class="form-group">
                    <label for="tipo-vehiculo"
                      ><i class="fas fa-car"></i> Tipo de Vehículo</label
                    >
                    <select id="tipo-vehiculo">
                      <option value="">Seleccione tipo</option>
                      <option value="carro">Carro</option>
                      <option value="jeepeta">Jeepeta</option>
                      <option value="motor">Motor</option>
                      <option value="camion">Camión</option>
                    </select>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="cliente-vehiculo"
                      ><i class="fas fa-user"></i> Cliente</label
                    >
                    <input
                      type="text"
                      id="cliente-vehiculo"
                      placeholder="Nombre del cliente"
                    />
                  </div>
                  <div class="form-group">
                    <label for="telefono-vehiculo"
                      ><i class="fas fa-phone"></i> Teléfono</label
                    >
                    <input
                      type="text"
                      id="telefono-vehiculo"
                      placeholder="Teléfono"
                    />
                  </div>
                </div>
                <div class="form-group">
                  <label for="empleado-vehiculo"
                    ><i class="fas fa-user-tie"></i> Empleado Asignado</label
                  >
                  <select id="empleado-vehiculo">
                    <!-- Se cargarán dinámicamente -->
                  </select>
                </div>
                <div class="form-group">
                  <label for="notas-vehiculo"
                    ><i class="fas fa-sticky-note"></i> Notas (Opcional)</label
                  >
                  <textarea
                    id="notas-vehiculo"
                    rows="3"
                    placeholder="Notas adicionales"
                  ></textarea>
                </div>
                <button class="btn btn-success" id="saveVehicleBtn">
                  <i class="fas fa-save"></i> Registrar Vehículo
                </button>
              </div>
            </div>

            <div class="tab-content" id="carwash-proceso">
              <div class="vehicles-grid" id="vehiclesGrid">
                <!-- Los vehículos en proceso se cargarán dinámicamente -->
              </div>
            </div>

            <div class="tab-content" id="carwash-entregados">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Vehículo</th>
                      <th>Tipo</th>
                      <th>Cliente</th>
                      <th>Servicios</th>
                      <th>Total</th>
                      <th>Hora Entrada</th>
                      <th>Hora Salida</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="completedVehiclesTable">
                    <!-- Los vehículos entregados se cargarán dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>

            <div class="tab-content" id="carwash-servicios">
              <!-- Servicios de Car Wash con scroll táctil y deslizamiento -->
              <div class="page-title" style="margin-bottom: 10px">
                <h3>Servicios de Car Wash</h3>
                <small style="color: var(--text-secondary)"
                  >Arrastra para reordenar los servicios</small
                >
              </div>
              <div class="scroll-indicator">
                <i class="fas fa-arrows-alt"></i>
                <span
                  >Desliza para ver más servicios - Arrastra para
                  reordenar</span
                >
              </div>
              <div class="touch-scroll-container" id="carwash-touch-container">
                <!-- Los servicios se cargarán dinámicamente -->
              </div>

              <div class="pos-container">
                <div>
                  <div class="form-group">
                    <label for="vehiculo-servicio"
                      ><i class="fas fa-car"></i> Vehículo</label
                    >
                    <select id="vehiculo-servicio">
                      <!-- Se cargarán dinámicamente -->
                    </select>
                  </div>
                </div>

                <!-- Carrito de Venta Car Wash - CON RNC -->
                <div class="cart">
                  <div class="cart-header">
                    <div class="cart-title">Carrito de Servicios</div>
                    <div class="badge badge-info" id="cartCountCarwash">
                      0 servicios
                    </div>
                  </div>

                  <div class="cart-items" id="cartItemsCarwash">
                    <!-- Los servicios del carrito se cargarán dinámicamente -->
                  </div>

                  <div class="cart-total" id="cartTotalCarwash">
                    Total: RD$ 0
                  </div>

                  <!-- Campo RNC Opcional -->
                  <div class="rnc-field">
                    <label for="rnc-carwash">
                      <i class="fas fa-id-card"></i> RNC (Opcional para factura)
                      <span class="rnc-optional"
                        >Dejar vacío para "Consumidor Final"</span
                      >
                    </label>
                    <div class="rnc-input">
                      <input
                        type="text"
                        id="rnc-carwash"
                        placeholder="Ej: 133577461"
                        maxlength="11"
                        value="133577461"
                      />
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="metodo-pago-carwash">Método de Pago</label>
                    <select id="metodo-pago-carwash">
                      <option value="efectivo">Efectivo</option>
                      <option value="tarjeta">Tarjeta</option>
                      <option value="transferencia">Transferencia</option>
                    </select>
                  </div>

                  <!-- Campo de aprobación para tarjeta -->
                  <div
                    class="approval-field"
                    id="approvalFieldCarwash"
                    style="display: none"
                  >
                    <label for="aprobacion-carwash">
                      <i class="fas fa-credit-card"></i> Aprobación de Tarjeta /
                      Comprobante
                      <span class="rnc-optional"
                        >Número de aprobación o comprobante</span
                      >
                    </label>
                    <div class="approval-input">
                      <input
                        type="text"
                        id="aprobacion-carwash"
                        placeholder="Ej: 123456"
                      />
                    </div>
                  </div>

                  <div class="form-group" id="cashPaymentSectionCarwash">
                    <label for="efectivo-recibido-carwash"
                      >Efectivo Recibido</label
                    >
                    <input
                      type="number"
                      id="efectivo-recibido-carwash"
                      placeholder="RD$"
                      value="0"
                    />
                    <div
                      id="cambio-display-carwash"
                      style="
                        margin-top: 10px;
                        font-weight: bold;
                        color: var(--accent);
                      "
                    >
                      Cambio: RD$ 0
                    </div>
                  </div>

                  <div class="payment-validation" id="paymentValidationCarwash">
                    <i class="fas fa-exclamation-circle"></i> El efectivo
                    recibido es menor al total. Verifique el pago.
                  </div>

                  <button
                    class="btn btn-primary btn-block"
                    id="printTicketBtnCarwash"
                  >
                    <i class="fas fa-print"></i> Imprimir Ticket
                  </button>
                  <button
                    class="btn btn-success btn-block"
                    id="confirmSaleBtnCarwash"
                  >
                    <i class="fas fa-check"></i> Confirmar Venta
                  </button>
                </div>
              </div>
            </div>

            <div class="tab-content" id="carwash-historial">
              <div class="form-container">
                <div class="form-row">
                  <div class="form-group">
                    <label for="fecha-carwash">Fecha</label>
                    <input type="date" id="fecha-carwash" />
                  </div>
                  <div class="form-group">
                    <label for="tipo-filtro">Tipo de Vehículo</label>
                    <select id="tipo-filtro">
                      <option value="">Todos los tipos</option>
                      <option value="carro">Carro</option>
                      <option value="jeepeta">Jeepeta</option>
                      <option value="motor">Motor</option>
                      <option value="camion">Camión</option>
                    </select>
                  </div>
                </div>

                <button class="btn btn-primary" id="searchCarwashBtn">
                  <i class="fas fa-search"></i> Buscar
                </button>
              </div>

              <div class="table-container" style="margin-top: 20px">
                <table>
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Vehículo</th>
                      <th>Tipo</th>
                      <th>Servicios</th>
                      <th>Total</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="carwashHistoryTable">
                    <!-- El historial se cargará dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- ============================================= -->
          <!-- PÁGINAS DE CONFIGURACIÓN -->
          <!-- ============================================= -->

          <!-- Configuración - Cierre de Caja -->
          <div class="page" id="config-cierre">
            <div class="page-title">
              <h1>Cierre de Caja</h1>
              <button class="btn btn-success" id="processCashClosingBtn">
                <i class="fas fa-calculator"></i> Procesar Cierre
              </button>
            </div>

            <div class="cash-closing-container">
              <h3><i class="fas fa-cash-register"></i> Resumen del Día</h3>
              <div class="cash-summary" id="cashSummary">
                <!-- Se cargará dinámicamente -->
              </div>

              <div class="cash-total">
                <h3>TOTAL ESPERADO EN CAJA</h3>
                <div class="cash-total-amount" id="expectedTotal">RD$ 0</div>
                <p>Suma total de todas las ventas del día</p>
              </div>

              <div class="form-container">
                <h3><i class="fas fa-clipboard-check"></i> Cierre de Caja</h3>
                <div class="form-row">
                  <div class="form-group">
                    <label for="efectivo-contado">Efectivo Contado</label>
                    <input
                      type="number"
                      id="efectivo-contado"
                      placeholder="RD$"
                    />
                  </div>
                  <div class="form-group">
                    <label for="fecha-cierre">Fecha de Cierre</label>
                    <input type="datetime-local" id="fecha-cierre" />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="responsable">Responsable</label>
                    <input
                      type="text"
                      id="responsable"
                      placeholder="Nombre del responsable"
                    />
                  </div>
                  <div class="form-group">
                    <label for="turno">Turno</label>
                    <select id="turno">
                      <option value="matutino">Matutino</option>
                      <option value="vespertino">Vespertino</option>
                      <option value="nocturno">Nocturno</option>
                      <option value="completo">Completo</option>
                    </select>
                  </div>
                </div>

                <div
                  class="cash-discrepancy"
                  id="discrepancySection"
                  style="display: none"
                >
                  <h4>
                    <i class="fas fa-exclamation-triangle"></i> DISCREPANCIA
                    DETECTADA
                  </h4>
                  <p>
                    Existe una diferencia entre el efectivo contado y el
                    esperado.
                  </p>
                  <div
                    id="discrepancyAmount"
                    style="font-size: 1.5rem; font-weight: bold; margin: 10px 0"
                  ></div>

                  <div class="discrepancy-form">
                    <div class="form-group">
                      <label for="discrepancy-reason"
                        >Motivo de la Diferencia</label
                      >
                      <select id="discrepancy-reason">
                        <option value="">Seleccione motivo</option>
                        <option value="error_cambio">Error en cambio</option>
                        <option value="venta_no_registrada">
                          Venta no registrada
                        </option>
                        <option value="gasto_operativo">Gasto operativo</option>
                        <option value="otro">Otro</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="discrepancy-notes">Notas</label>
                      <textarea
                        id="discrepancy-notes"
                        rows="2"
                        placeholder="Explicación de la diferencia"
                      ></textarea>
                    </div>
                  </div>
                </div>

                <button
                  class="btn btn-primary btn-block"
                  id="calculateDiscrepancyBtn"
                >
                  <i class="fas fa-calculator"></i> Calcular Diferencia
                </button>
                <button
                  class="btn btn-success btn-block"
                  id="finalizeClosingBtn"
                >
                  <i class="fas fa-check-circle"></i> Finalizar Cierre
                </button>
              </div>

              <div class="table-container" style="margin-top: 30px">
                <h3>Historial de Cierres</h3>
                <table>
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Responsable</th>
                      <th>Efectivo</th>
                      <th>Tarjeta</th>
                      <th>Transferencia</th>
                      <th>Total</th>
                      <th>Estado</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="closingHistoryTable">
                    <!-- Historial de cierres -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Configuración - Contabilidad -->
          <div class="page" id="config-contabilidad">
            <div class="page-title">
              <h1>Integración Contable</h1>
              <button class="btn btn-success" id="syncAccountingBtn">
                <i class="fas fa-sync-alt"></i> Sincronizar
              </button>
            </div>

            <div class="accounting-container">
              <h3><i class="fas fa-chart-line"></i> Resumen Contable</h3>

              <div class="accounting-summary">
                <div class="accounting-card">
                  <h4>
                    <i class="fas fa-money-bill-wave"></i> Ingresos del Mes
                  </h4>
                  <div class="accounting-value" id="monthlyIncome">RD$ 0</div>
                  <div class="accounting-trend" id="incomeTrendText">
                    Cargando...
                  </div>
                </div>

                <div class="accounting-card">
                  <h4>
                    <i class="fas fa-shopping-cart"></i> Gastos Operativos
                  </h4>
                  <div class="accounting-value" id="monthlyExpenses">RD$ 0</div>
                  <div class="accounting-trend" id="expensesTrendText">
                    Cargando...
                  </div>
                </div>

                <div class="accounting-card">
                  <h4><i class="fas fa-piggy-bank"></i> Utilidad Neta</h4>
                  <div class="accounting-value" id="netProfit">RD$ 0</div>
                  <div class="accounting-trend" id="profitTrendText">
                    Cargando...
                  </div>
                </div>

                <div class="accounting-card">
                  <h4><i class="fas fa-receipt"></i> Facturas Emitidas</h4>
                  <div class="accounting-value" id="invoicesCount">0</div>
                  <div class="accounting-trend" id="invoicesTrendText">
                    Este mes
                  </div>
                </div>
              </div>

              <div class="form-container">
                <h3>
                  <i class="fas fa-cogs"></i> Configuración de Integración
                </h3>
                <div class="form-row">
                  <div class="form-group">
                    <label for="accounting-system">Sistema Contable</label>
                    <select id="accounting-system">
                      <option value="cashflow">Cashflow</option>
                      <option value="quickbooks">QuickBooks</option>
                      <option value="xero">Xero</option>
                      <option value="sap">SAP</option>
                      <option value="other">Otro</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="sync-frequency"
                      >Frecuencia de Sincronización</label
                    >
                    <select id="sync-frequency">
                      <option value="realtime">Tiempo Real</option>
                      <option value="hourly">Cada Hora</option>
                      <option value="daily" selected>Diariamente</option>
                      <option value="weekly">Semanalmente</option>
                    </select>
                  </div>
                </div>

                <div class="form-group">
                  <label for="api-key">API Key / Token</label>
                  <input
                    type="password"
                    id="api-key"
                    placeholder="Ingrese su API Key"
                  />
                </div>

                <div class="form-group">
                  <label for="api-url">URL del Sistema</label>
                  <input
                    type="url"
                    id="api-url"
                    placeholder="https://api.cashflow.com"
                  />
                </div>

                <div class="form-group">
                  <label>
                    <input type="checkbox" id="auto-sync" checked />
                    Sincronización Automática
                  </label>
                </div>

                <div class="form-group">
                  <label>
                    <input type="checkbox" id="include-taxes" checked />
                    Incluir Impuestos en Sincronización
                  </label>
                </div>

                <button class="btn btn-primary" id="saveAccountingConfigBtn">
                  <i class="fas fa-save"></i> Guardar Configuración
                </button>
                <button
                  class="btn btn-success"
                  id="testConnectionBtn"
                  style="margin-left: 10px"
                >
                  <i class="fas fa-plug"></i> Probar Conexión
                </button>
              </div>

              <div class="export-options">
                <div class="export-option" id="exportExcelBtnAccounting">
                  <i class="fas fa-file-excel"></i>
                  <h4>Exportar a Excel</h4>
                  <p>Reporte contable completo</p>
                </div>

                <div class="export-option" id="exportPdfBtnAccounting">
                  <i class="fas fa-file-pdf"></i>
                  <h4>Exportar a PDF</h4>
                  <p>Estado financiero</p>
                </div>

                <div class="export-option" id="exportJsonBtn">
                  <i class="fas fa-file-code"></i>
                  <h4>Exportar a JSON</h4>
                  <p>Para integraciones</p>
                </div>

                <div class="export-option" id="exportCsvBtn">
                  <i class="fas fa-file-csv"></i>
                  <h4>Exportar a CSV</h4>
                  <p>Para importar en otros sistemas</p>
                </div>
              </div>

              <div class="table-container" style="margin-top: 30px">
                <h3>
                  <i class="fas fa-history"></i> Historial de Sincronización
                </h3>
                <table>
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Tipo</th>
                      <th>Registros</th>
                      <th>Estado</th>
                      <th>Detalles</th>
                    </tr>
                  </thead>
                  <tbody id="syncHistoryTable">
                    <!-- Historial de sincronización -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Configuración - Usuarios -->
          <div class="page" id="config-usuarios">
            <div class="page-title">
              <h1>Configuración de Usuarios</h1>
              <button class="btn btn-primary" id="addUserBtn">
                <i class="fas fa-plus"></i> Agregar Usuario
              </button>
            </div>

            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Usuario</th>
                    <th>Rol</th>
                    <th>Fecha Registro</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="usersTable">
                  <!-- Los usuarios se cargarán dinámicamente -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Configuración - Servicios -->
          <div class="page" id="config-servicios">
            <div class="page-title">
              <h1>Configuración de Servicios</h1>
            </div>

            <div class="config-tabs">
              <div
                class="config-tab active"
                data-config-tab="barberia-servicios"
              >
                Servicios de Barbería
              </div>
              <div class="config-tab" data-config-tab="carwash-servicios">
                Servicios de Car Wash
              </div>
            </div>

            <!-- Servicios de Barbería -->
            <div class="tab-content active" id="barberia-servicios">
              <div class="config-section">
                <h3>Agregar Nuevo Servicio de Barbería</h3>
                <div class="form-row">
                  <div class="form-group">
                    <label for="servicio-barberia-nombre"
                      >Nombre del Servicio</label
                    >
                    <input
                      type="text"
                      id="servicio-barberia-nombre"
                      placeholder="Ej: Corte de Cabello"
                    />
                  </div>
                  <div class="form-group">
                    <label for="servicio-barberia-precio">Precio (RD$)</label>
                    <input
                      type="number"
                      id="servicio-barberia-precio"
                      placeholder="250"
                    />
                  </div>
                </div>
                <div class="form-group">
                  <label for="servicio-barberia-descripcion"
                    >Descripción (Opcional)</label
                  >
                  <textarea
                    id="servicio-barberia-descripcion"
                    rows="2"
                    placeholder="Descripción del servicio"
                  ></textarea>
                </div>
                <button class="btn btn-primary" id="agregar-servicio-barberia">
                  <i class="fas fa-plus"></i> Agregar Servicio
                </button>
              </div>

              <div class="config-section">
                <h3>Servicios Configurados</h3>
                <div class="table-container">
                  <table>
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Servicio</th>
                        <th>Precio</th>
                        <th>Descripción</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="barberia-servicios-lista">
                      <!-- Los servicios se cargarán dinámicamente -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Servicios de Car Wash -->
            <div class="tab-content" id="carwash-servicios">
              <div class="config-section">
                <h3>Agregar Nuevo Servicio de Car Wash</h3>
                <div class="form-row">
                  <div class="form-group">
                    <label for="servicio-carwash-nombre"
                      >Nombre del Servicio</label
                    >
                    <input
                      type="text"
                      id="servicio-carwash-nombre"
                      placeholder="Ej: Lavado Completo"
                    />
                  </div>
                  <div class="form-group">
                    <label for="servicio-carwash-precio">Precio (RD$)</label>
                    <input
                      type="number"
                      id="servicio-carwash-precio"
                      placeholder="450"
                    />
                  </div>
                </div>
                <div class="form-group">
                  <label for="servicio-carwash-descripcion"
                    >Descripción (Opcional)</label
                  >
                  <textarea
                    id="servicio-carwash-descripcion"
                    rows="2"
                    placeholder="Descripción del servicio"
                  ></textarea>
                </div>
                <button class="btn btn-primary" id="agregar-servicio-carwash">
                  <i class="fas fa-plus"></i> Agregar Servicio
                </button>
              </div>

              <div class="config-section">
                <h3>Servicios Configurados</h3>
                <div class="table-container">
                  <table>
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Servicio</th>
                        <th>Precio</th>
                        <th>Descripción</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="carwash-servicios-lista">
                      <!-- Los servicios se cargarán dinámicamente -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <!-- Configuración - Productos -->
          <div class="page" id="config-productos">
            <div class="page-title">
              <h1>Configuración de Productos</h1>
            </div>

            <div class="config-section">
              <h3>Agregar Nuevo Producto</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="producto-nombre">Nombre del Producto</label>
                  <input
                    type="text"
                    id="producto-nombre"
                    placeholder="Ej: Refresco Cola"
                  />
                </div>
                <div class="form-group">
                  <label for="producto-codigo">Código (Opcional)</label>
                  <input
                    type="text"
                    id="producto-codigo"
                    placeholder="Código interno"
                  />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="producto-precio-compra"
                    >Precio de Compra (RD$)</label
                  >
                  <input
                    type="number"
                    id="producto-precio-compra"
                    placeholder="80"
                  />
                </div>
                <div class="form-group">
                  <label for="producto-precio-venta"
                    >Precio de Venta (RD$)</label
                  >
                  <input
                    type="number"
                    id="producto-precio-venta"
                    placeholder="100"
                  />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="producto-stock">Stock Inicial</label>
                  <input type="number" id="producto-stock" placeholder="50" />
                </div>
                <div class="form-group">
                  <label for="producto-categoria">Categoría</label>
                  <select id="producto-categoria">
                    <option value="bebidas">Bebidas</option>
                    <option value="snacks">Snacks</option>
                    <option value="otros">Otros</option>
                  </select>
                </div>
              </div>
              <button class="btn btn-primary" id="agregar-producto">
                <i class="fas fa-plus"></i> Agregar Producto
              </button>
            </div>

            <div class="config-section">
              <h3>Productos Configurados</h3>
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Producto</th>
                      <th>Código</th>
                      <th>P. Compra</th>
                      <th>P. Venta</th>
                      <th>Stock</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="productos-lista">
                    <!-- Los productos se cargarán dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Configuración - Empleados -->
          <div class="page" id="config-empleados">
            <div class="page-title">
              <h1>Configuración de Empleados</h1>
              <button class="btn btn-primary" id="addEmployeeBtn">
                <i class="fas fa-plus"></i> Agregar Empleado
              </button>
            </div>

            <div class="config-section">
              <h3>Agregar Nuevo Empleado</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="empleado-nombre">Nombre Completo</label>
                  <input
                    type="text"
                    id="empleado-nombre"
                    placeholder="Nombre del empleado"
                  />
                </div>
                <div class="form-group">
                  <label for="empleado-cedula">Cédula</label>
                  <input
                    type="text"
                    id="empleado-cedula"
                    placeholder="Cédula"
                  />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="empleado-telefono">Teléfono</label>
                  <input
                    type="text"
                    id="empleado-telefono"
                    placeholder="Teléfono"
                  />
                </div>
                <div class="form-group">
                  <label for="empleado-cargo">Cargo</label>
                  <select id="empleado-cargo">
                    <option value="barbero">Barbero</option>
                    <option value="lavador">Lavador</option>
                    <option value="vendedor">Vendedor</option>
                    <option value="administrador">Administrador</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label for="empleado-sueldo">Sueldo (RD$)</label>
                <input
                  type="number"
                  id="empleado-sueldo"
                  placeholder="Sueldo mensual"
                />
              </div>
              <button class="btn btn-primary" id="saveEmployeeBtn">
                <i class="fas fa-save"></i> Guardar Empleado
              </button>
            </div>

            <div class="config-section">
              <h3>Empleados Registrados</h3>
              <div class="employees-grid" id="employeesGrid">
                <!-- Los empleados se cargarán dinámicamente -->
              </div>
            </div>
          </div>

          <!-- Configuración - Impresora -->
          <div class="page" id="config-impresora">
            <div class="page-title">
              <h1>Configuración de Impresora</h1>
            </div>

            <div class="form-container">
              <div class="form-group">
                <label for="printer-type">Tipo de Impresora</label>
                <select id="printer-type">
                  <option value="ticket">Impresora de Tickets (82mm)</option>
                  <option value="fiscal">Impresora Fiscal</option>
                  <option value="normal">Impresora Normal</option>
                </select>
              </div>

              <div class="form-group">
                <label for="printer-name">Nombre de la Impresora</label>
                <input
                  type="text"
                  id="printer-name"
                  placeholder="Nombre de la impresora en el sistema"
                />
              </div>

              <div class="form-group">
                <label for="paper-width">Ancho del Papel (mm)</label>
                <input
                  type="number"
                  id="paper-width"
                  value="82"
                  min="40"
                  max="120"
                />
              </div>

              <div class="form-group">
                <label for="company-name">Nombre de la Empresa</label>
                <input
                  type="text"
                  id="company-name"
                  placeholder="STARK CLEANE"
                />
              </div>

              <div class="form-group">
                <label for="company-address">Dirección</label>
                <input
                  type="text"
                  id="company-address"
                  placeholder="Dirección de la empresa"
                />
              </div>

              <div class="form-group">
                <label for="company-phone">Teléfono</label>
                <input
                  type="text"
                  id="company-phone"
                  placeholder="Teléfono de la empresa"
                />
              </div>

              <div class="form-group">
                <label for="company-rnc">RNC (Opcional)</label>
                <input
                  type="text"
                  id="company-rnc"
                  placeholder="RNC de la empresa"
                  value="133577461"
                />
              </div>

              <div class="form-group">
                <h3>Prueba de Impresión</h3>
                <div class="printer-options">
                  <div class="printer-option" data-test="ticket">
                    <i class="fas fa-receipt"></i>
                    <h4>Ticket de Prueba</h4>
                    <p>Imprime un ticket de prueba</p>
                  </div>
                  <div class="printer-option" data-test="config">
                    <i class="fas fa-cog"></i>
                    <h4>Configuración</h4>
                    <p>Imprime configuración actual</p>
                  </div>
                </div>
              </div>

              <button class="btn btn-primary" id="savePrinterConfigBtn">
                <i class="fas fa-save"></i> Guardar Configuración
              </button>
              <button
                class="btn btn-success"
                id="testPrinterBtn"
                style="margin-left: 10px"
              >
                <i class="fas fa-print"></i> Probar Impresión
              </button>
            </div>
          </div>

          <!-- Configuración - Tema -->
          <div class="page" id="config-tema">
            <div class="page-title">
              <h1>Configuración - Tema</h1>
            </div>

            <div class="form-container">
              <div class="form-group">
                <label for="select-tema">Seleccionar Tema</label>
                <select id="select-tema">
                  <option value="dark">Oscuro</option>
                  <option value="light">Claro</option>
                </select>
              </div>

              <div class="form-group">
                <label>Vista Previa</label>
                <div class="card-system">
                  <div class="card-icon barberia">
                    <i class="fas fa-cut"></i>
                  </div>
                  <h3>Ejemplo de Tarjeta</h3>
                  <p>Esta es una vista previa del tema seleccionado</p>
                </div>
              </div>

              <button class="btn btn-primary" id="saveThemeBtn">
                <i class="fas fa-save"></i> Guardar Configuración
              </button>
            </div>
          </div>

          <!-- Configuración Jarvis - CON COMANDOS PERSONALIZADOS -->
          <div class="page" id="config-jarvis">
            <div class="page-title">
              <h1>Configuración Jarvis</h1>
            </div>

            <div class="form-container">
              <div class="form-group">
                <label for="jarvis-voice-key"
                  >Tecla de Activación por Voz</label
                >
                <input type="text" id="jarvis-voice-key" value="F2" readonly />
                <small>Presiona F2 para activar el comando de voz</small>
              </div>

              <div class="form-group">
                <label for="jarvis-ai-mode">Modo de IA</label>
                <select id="jarvis-ai-mode">
                  <option value="avanzado">Avanzado (Recomendado)</option>
                  <option value="basico">Básico</option>
                </select>
              </div>

              <div class="form-group">
                <label>
                  <input type="checkbox" id="jarvis-voice-responses" checked />
                  Respuestas por Voz
                </label>
              </div>

              <div class="form-group">
                <label>
                  <input type="checkbox" id="jarvis-auto-actions" checked />
                  Acciones Automáticas
                </label>
              </div>
            </div>

            <!-- NUEVA SECCIÓN: COMANDOS PERSONALIZADOS -->
            <div class="jarvis-commands-container">
              <h3>
                <i class="fas fa-terminal"></i> Comandos Personalizados de
                Jarvis
              </h3>
              <p>
                Agrega tus propios comandos de voz para automatizar tareas
                frecuentes.
              </p>

              <div class="config-section">
                <h4>Agregar Nuevo Comando</h4>
                <div class="form-row">
                  <div class="form-group">
                    <label for="command-trigger">Comando de Voz</label>
                    <input
                      type="text"
                      id="command-trigger"
                      placeholder="Ej: 'abrir barbería'"
                    />
                    <small
                      >Lo que el usuario debe decir para activar el
                      comando</small
                    >
                  </div>
                  <div class="form-group">
                    <label for="command-action">Acción a Ejecutar</label>
                    <select id="command-action">
                      <option value="open_page">Abrir Página</option>
                      <option value="create_sale">Crear Venta</option>
                      <option value="generate_report">Generar Reporte</option>
                      <option value="search_item">Buscar Item</option>
                      <option value="custom_code">Código Personalizado</option>
                    </select>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="command-page">Página Destino (si aplica)</label>
                    <select id="command-page">
                      <option value="dashboard">Dashboard</option>
                      <option value="barberia">Barbería</option>
                      <option value="billar">Billar</option>
                      <option value="carwash">Car Wash</option>
                      <option value="config-cierre">Cierre de Caja</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="command-description">Descripción</label>
                    <input
                      type="text"
                      id="command-description"
                      placeholder="Ej: Abre la sección de barbería"
                    />
                  </div>
                </div>

                <div
                  class="form-group"
                  id="custom-code-section"
                  style="display: none"
                >
                  <label for="command-custom-code"
                    >Código JavaScript Personalizado</label
                  >
                  <textarea
                    id="command-custom-code"
                    rows="3"
                    placeholder="Ej: showNotification('Comando ejecutado', 'success');"
                  ></textarea>
                  <small
                    >Sólo para usuarios avanzados. Escribe código JavaScript
                    seguro.</small
                  >
                </div>

                <button class="btn btn-primary" id="addCustomCommandBtn">
                  <i class="fas fa-plus"></i> Agregar Comando
                </button>
              </div>

              <div class="config-section">
                <h4>Comandos Configurados</h4>
                <div id="custom-commands-list">
                  <!-- Los comandos personalizados se cargarán aquí -->
                </div>
              </div>
            </div>

            <div class="form-container" style="margin-top: 20px">
              <h3>Comandos de Voz Predefinidos</h3>
              <div
                style="
                  background: var(--hover-color);
                  padding: 15px;
                  border-radius: 8px;
                  margin-top: 10px;
                "
              >
                <p>
                  <strong>"Abrir [módulo]"</strong> - Navega a cualquier módulo
                </p>
                <p>
                  <strong>"Registrar cita para [nombre] con [barbero]"</strong>
                  - Crea cita automáticamente
                </p>
                <p>
                  <strong>"Registrar vehículo [tipo] para [servicio]"</strong> -
                  Registra vehículo automáticamente
                </p>
                <p>
                  <strong>"Agregar producto [nombre] precio [valor]"</strong> -
                  Agrega producto al inventario
                </p>
                <p>
                  <strong>"Resumen del día"</strong> - Muestra reporte diario
                </p>
                <p>
                  <strong>"Buscar [cliente/producto/vehículo]"</strong> -
                  Realiza búsquedas
                </p>
                <p>
                  <strong>"Facturar venta"</strong> - Genera factura de la venta
                  actual
                </p>
                <p>
                  <strong>"Ver inventario"</strong> - Muestra el inventario
                  actual
                </p>
                <p>
                  <strong>"Reporte de ventas"</strong> - Genera reporte de
                  ventas
                </p>
                <p>
                  <strong>"Configurar [opción]"</strong> - Abre configuración
                  específica
                </p>
              </div>
            </div>

            <button
              class="btn btn-primary"
              id="saveJarvisConfigBtn"
              style="margin-top: 20px; width: 100%"
            >
              <i class="fas fa-save"></i> Guardar Configuración Jarvis
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para agregar producto -->
    <div class="modal" id="productModal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">Agregar Nuevo Producto</div>
          <button class="modal-close" id="closeProductModal">&times;</button>
        </div>
        <div class="form-container">
          <div class="form-row">
            <div class="form-group">
              <label for="codigo-barra-producto">Código de Barras</label>
              <input
                type="text"
                id="codigo-barra-producto"
                placeholder="Ingrese código de barras"
              />
            </div>
            <div class="form-group">
              <label for="nombre-producto">Nombre del Producto</label>
              <input
                type="text"
                id="nombre-producto"
                placeholder="Ingrese nombre del producto"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="categoria-producto">Categoría</label>
              <select id="categoria-producto">
                <option value="">Seleccione categoría</option>
                <option value="bebidas">Bebidas</option>
                <option value="snacks">Snacks</option>
                <option value="licores">Licores</option>
                <option value="otros">Otros</option>
              </select>
            </div>
            <div class="form-group">
              <label for="fecha-ingreso">Fecha de Ingreso</label>
              <input type="date" id="fecha-ingreso" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="precio-compra">Precio de Compra</label>
              <input type="number" id="precio-compra" placeholder="RD$" />
            </div>
            <div class="form-group">
              <label for="precio-venta">Precio de Venta</label>
              <input type="number" id="precio-venta" placeholder="RD$" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="cantidad-stock">Cantidad en Stock</label>
              <input type="number" id="cantidad-stock" placeholder="Cantidad" />
            </div>
            <div class="form-group">
              <label for="alerta-stock">Alerta de Stock</label>
              <input type="number" id="alerta-stock" placeholder="Mínimo" />
            </div>
          </div>

          <button class="btn btn-primary" id="saveProductBtn">
            <i class="fas fa-save"></i> Guardar Producto
          </button>
        </div>
      </div>
    </div>

    <!-- Factura Modal -->
    <div class="modal" id="invoiceModal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">Factura</div>
          <button class="modal-close" id="closeInvoiceModal">&times;</button>
        </div>
        <div class="invoice-container" id="invoiceContent">
          <!-- La factura se generará aquí -->
        </div>
        <div
          class="action-buttons"
          style="margin-top: 20px; justify-content: center"
        >
          <button class="btn btn-primary" id="printInvoiceBtn">
            <i class="fas fa-print"></i> Imprimir
          </button>
          <button class="btn btn-success" id="downloadInvoiceBtn">
            <i class="fas fa-download"></i> Descargar PDF
          </button>
        </div>
      </div>
    </div>

    <!-- Jarvis AI Assistant -->
    <div class="jarvis-container">
      <button class="jarvis-btn" id="jarvisButton">
        <i class="fas fa-robot"></i>
      </button>
      <div class="jarvis-chat" id="jarvisChat">
        <div class="jarvis-header">
          <div>
            <h3><i class="fas fa-robot"></i> Jarvis</h3>
            <p>Asistente Inteligente</p>
          </div>
          <button class="modal-close" id="closeJarvis">&times;</button>
        </div>
        <div class="jarvis-messages" id="jarvisMessages">
          <div class="message jarvis">
            ¡Hola! Soy Jarvis, tu asistente inteligente. ¿En qué puedo ayudarte
            hoy?
          </div>
        </div>
        <div class="jarvis-input">
          <input
            type="text"
            id="jarvisInput"
            placeholder="Escribe tu mensaje..."
          />
          <button id="sendJarvis">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Voice Command Key -->
    <div class="voice-key">
      <button
        class="voice-key-btn"
        id="voiceKeyBtn"
        title="Presiona F2 para activar voz"
      >
        <i class="fas fa-microphone"></i>
      </button>
    </div>

    <script>
      // =============================================
      // SISTEMA DE USUARIOS Y LOGIN MEJORADO
      // =============================================

      // Sistema de gestión de usuarios
      const UserSystem = {
        init: function () {
          if (!localStorage.getItem("stark_users")) {
            // Usuarios por defecto
            const defaultUsers = [
              {
                id: 1,
                username: "admin",
                password: "admin123",
                role: "admin",
                created: new Date().toISOString(),
                avatar: "A",
              },
              {
                id: 2,
                username: "vendedor",
                password: "vendedor123",
                role: "vendedor",
                created: new Date().toISOString(),
                avatar: "V",
              },
            ];
            localStorage.setItem("stark_users", JSON.stringify(defaultUsers));
          }
        },

        getUsers: function () {
          return JSON.parse(localStorage.getItem("stark_users")) || [];
        },

        saveUsers: function (users) {
          localStorage.setItem("stark_users", JSON.stringify(users));
        },

        authenticate: function (username, password) {
          const users = this.getUsers();
          return users.find(
            (user) => user.username === username && user.password === password
          );
        },

        register: function (username, password, role) {
          const users = this.getUsers();

          if (users.length >= 5) {
            return {
              success: false,
              message: "Límite de usuarios alcanzado (máximo 5)",
            };
          }

          if (users.some((user) => user.username === username)) {
            return { success: false, message: "El usuario ya existe" };
          }

          if (password.length < 6) {
            return {
              success: false,
              message: "La contraseña debe tener al menos 6 caracteres",
            };
          }

          const newUser = {
            id: Date.now(),
            username: username,
            password: password,
            role: role,
            created: new Date().toISOString(),
            avatar: username.charAt(0).toUpperCase(),
          };

          users.push(newUser);
          this.saveUsers(users);

          return { success: true, message: "Usuario registrado exitosamente" };
        },

        deleteUser: function (id) {
          const users = this.getUsers();
          const filtered = users.filter((user) => user.id !== id);
          this.saveUsers(filtered);
          return filtered;
        },

        updateUser: function (id, updates) {
          const users = this.getUsers();
          const index = users.findIndex((user) => user.id === id);
          if (index !== -1) {
            users[index] = { ...users[index], ...updates };
            this.saveUsers(users);
            return true;
          }
          return false;
        },
      };

      // Inicializar sistema de usuarios
      UserSystem.init();

      // =============================================
      // SISTEMA DE LOGIN Y REGISTRO MEJORADO
      // =============================================

      document.addEventListener("DOMContentLoaded", function () {
        // Configurar tabs del login
        const loginTab = document.getElementById("loginTab");
        const registerTab = document.getElementById("registerTab");
        const loginForm = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");

        loginTab.addEventListener("click", function () {
          loginTab.classList.add("active");
          registerTab.classList.remove("active");
          loginForm.classList.add("active");
          registerForm.classList.remove("active");
          clearErrors();
        });

        registerTab.addEventListener("click", function () {
          registerTab.classList.add("active");
          loginTab.classList.remove("active");
          registerForm.classList.add("active");
          loginForm.classList.remove("active");
          clearErrors();
        });

        // Función para limpiar errores
        function clearErrors() {
          document.querySelectorAll(".error-message").forEach((el) => {
            el.classList.add("d-none");
          });
          document.querySelectorAll(".form-control").forEach((el) => {
            el.classList.remove("error");
          });
        }

        // Función para mostrar error
        function showError(elementId, message) {
          const errorEl = document.getElementById(elementId);
          const inputEl =
            errorEl.previousElementSibling?.querySelector(".form-control");

          if (errorEl) {
            errorEl.textContent = message;
            errorEl.classList.remove("d-none");
          }

          if (inputEl) {
            inputEl.classList.add("error");
          }
        }

        // Función para validar formulario
        function validateLogin() {
          let isValid = true;
          const username = document
            .getElementById("login-username")
            .value.trim();
          const password = document.getElementById("login-password").value;

          clearErrors();

          if (!username) {
            showError("loginUserError", "El usuario es requerido");
            isValid = false;
          }

          if (!password) {
            showError("loginPassError", "La contraseña es requerida");
            isValid = false;
          }

          return isValid;
        }

        function validateRegister() {
          let isValid = true;
          const username = document
            .getElementById("register-username")
            .value.trim();
          const password = document.getElementById("register-password").value;
          const confirmPassword = document.getElementById(
            "register-confirm-password"
          ).value;

          clearErrors();

          if (!username) {
            showError("registerUserError", "El usuario es requerido");
            isValid = false;
          }

          if (!password) {
            showError("registerPassError", "La contraseña es requerida");
            isValid = false;
          } else if (password.length < 6) {
            showError("registerPassError", "Mínimo 6 caracteres");
            isValid = false;
          }

          if (!confirmPassword) {
            showError("registerConfirmError", "Confirme la contraseña");
            isValid = false;
          } else if (password !== confirmPassword) {
            showError("registerConfirmError", "Las contraseñas no coinciden");
            isValid = false;
          }

          return isValid;
        }

        // Evento de login
        document
          .getElementById("btn-login")
          .addEventListener("click", function () {
            if (!validateLogin()) return;

            const username = document
              .getElementById("login-username")
              .value.trim();
            const password = document.getElementById("login-password").value;

            const user = UserSystem.authenticate(username, password);

            if (user) {
              loginSuccessful(user);
            } else {
              showNotification("Usuario o contraseña incorrectos", "error");
              document.getElementById("login-password").classList.add("error");
            }
          });

        // Evento de registro
        document
          .getElementById("btn-register")
          .addEventListener("click", function () {
            if (!validateRegister()) return;

            const username = document
              .getElementById("register-username")
              .value.trim();
            const password = document.getElementById("register-password").value;
            const role = document.getElementById("register-role").value;

            const result = UserSystem.register(username, password, role);

            if (result.success) {
              showNotification(result.message, "success");

              // Cambiar a login
              loginTab.click();

              // Auto-completar login
              document.getElementById("login-username").value = username;
              document.getElementById("login-password").value = password;

              updateUserLimitMessage();
            } else {
              showNotification(result.message, "error");
            }
          });

        // Enter para login
        document
          .getElementById("login-password")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              document.getElementById("btn-login").click();
            }
          });

        // Enter para registro
        document
          .getElementById("register-confirm-password")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              document.getElementById("btn-register").click();
            }
          });

        // Actualizar mensaje de límite de usuarios
        function updateUserLimitMessage() {
          const users = UserSystem.getUsers();
          const messageEl = document.getElementById("user-limit-message");

          if (users.length >= 5) {
            messageEl.classList.remove("d-none");
          } else {
            messageEl.classList.add("d-none");
          }
        }

        updateUserLimitMessage();
      });

      // Función para login exitoso
      function loginSuccessful(user) {
        document.getElementById("screen-login").style.display = "none";
        document.getElementById("mainSystem").style.display = "flex";

        document.getElementById("currentUserName").textContent = user.username;
        document.getElementById("currentUserRole").textContent =
          user.role === "admin" ? "Administrador" : "Vendedor";
        document.getElementById("userAvatar").textContent = user.avatar;

        // Guardar usuario actual en localStorage
        localStorage.setItem("current_user", JSON.stringify(user));

        initApp();

        showNotification(
          `¡Bienvenido ${user.username}! Sistema cargado correctamente`,
          "success"
        );
      }

      // =============================================
      // SISTEMA DE DESLIZAMIENTO Y REORDENAMIENTO
      // =============================================

      const TouchSystem = {
        init: function () {
          this.setupTouchEvents();
          this.setupDragAndDrop();
        },

        setupTouchEvents: function () {
          // Eventos táctiles para las tarjetas
          document.addEventListener(
            "touchstart",
            function (e) {
              const touchCard = e.target.closest(".touch-service-card");
              if (touchCard) {
                touchCard.classList.add("selected");
              }
            },
            { passive: true }
          );

          document.addEventListener(
            "touchend",
            function (e) {
              const touchCard = e.target.closest(".touch-service-card");
              if (touchCard) {
                setTimeout(() => {
                  touchCard.classList.remove("selected");
                }, 300);
              }
            },
            { passive: true }
          );
        },

        setupDragAndDrop: function () {
          // Inicializar SortableJS para reordenar servicios
          this.initializeSortable(
            "barberia-touch-container",
            "barberia_services"
          );
          this.initializeSortable(
            "carwash-touch-container",
            "carwash_services"
          );
          this.initializeSortable("billar-products-touch", "productos");
        },

        initializeSortable: function (containerId, storageKey) {
          const container = document.getElementById(containerId);
          if (!container) return;

          new Sortable(container, {
            animation: 150,
            ghostClass: "sortable-ghost",
            chosenClass: "sortable-chosen",
            dragClass: "sortable-drag",
            handle: ".touch-service-card",
            filter: ".no-drag",
            preventOnFilter: false,
            scroll: true,
            scrollSensitivity: 50,
            scrollSpeed: 10,
            bubbleScroll: true,
            onEnd: function (evt) {
              // Guardar el nuevo orden en localStorage
              const items = Array.from(container.children).map((card) => {
                return {
                  id: parseInt(card.dataset.id),
                  name: card.querySelector("h4").textContent,
                  price: parseFloat(
                    card.querySelector(".price").textContent.replace("RD$ ", "")
                  ),
                  description:
                    card.querySelector(".description")?.textContent || "",
                };
              });

              // Actualizar en la base de datos
              if (storageKey === "productos") {
                // Para productos, necesitamos mantener toda la información
                const allProducts = DB.get("productos");
                const orderedProducts = [];

                items.forEach((item) => {
                  const fullProduct = allProducts.find((p) => p.id === item.id);
                  if (fullProduct) {
                    orderedProducts.push(fullProduct);
                  }
                });

                // Agregar los productos que no están en la vista (sin stock)
                allProducts.forEach((product) => {
                  if (!orderedProducts.find((p) => p.id === product.id)) {
                    orderedProducts.push(product);
                  }
                });

                DB.set("productos", orderedProducts);
              } else {
                // Para servicios, guardar orden
                localStorage.setItem(
                  `${storageKey}_order`,
                  JSON.stringify(items.map((item) => item.id))
                );
              }

              showNotification("Elementos reordenados", "success");
            },
          });
        },

        createTouchCard: function (item, type) {
          const card = document.createElement("div");
          card.className = "touch-service-card";
          card.dataset.id = item.id;

          let icon = "fa-cut";
          if (type === "carwash") icon = "fa-car";
          if (type === "product") icon = "fa-box";

          card.innerHTML = `
                    <i class="fas ${icon}"></i>
                    <h4>${item.nombre}</h4>
                    <div class="price">RD$ ${
                      item.precio || item.precio_venta
                    }</div>
                    ${
                      item.descripcion
                        ? `<div class="description">${item.descripcion}</div>`
                        : ""
                    }
                    ${
                      type === "product" && item.stock
                        ? `<small style="color: var(${
                            item.stock <= 5 ? "--danger" : "--text-secondary"
                          });">Stock: ${item.stock}</small>`
                        : ""
                    }
                `;

          // Evento click
          card.addEventListener("click", function (e) {
            if (e.target.closest(".touch-service-card") !== this) return;

            // Animación de pulsación
            this.style.transform = "scale(0.95)";
            setTimeout(() => {
              this.style.transform = "";
            }, 150);

            // Agregar al carrito según el tipo
            if (type === "barberia") {
              addToCartBarberia(
                item.id,
                item.nombre,
                item.precio,
                item.descripcion || ""
              );
            } else if (type === "carwash") {
              addToCartCarwash(
                item.id,
                item.nombre,
                item.precio,
                item.descripcion || ""
              );
            } else if (type === "product") {
              if (item.stock > 0) {
                addToCart(
                  item.id,
                  item.nombre,
                  item.precio_venta || item.precio
                );
              } else {
                showNotification("Producto sin stock", "error");
              }
            }

            showNotification(`${item.nombre} agregado al carrito`, "success");
          });

          return card;
        },

        loadTouchServices: function (containerId, items, type) {
          const container = document.getElementById(containerId);
          if (!container) return;

          container.innerHTML = "";

          if (items.length === 0) {
            container.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--text-secondary); width: 100%;">
                            <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>No hay ${
                              type === "product" ? "productos" : "servicios"
                            } configurados</p>
                        </div>
                    `;
            return;
          }

          // Aplicar orden guardado si existe
          if (type !== "product") {
            const orderKey =
              type === "barberia"
                ? "barberia_services_order"
                : "carwash_services_order";
            const savedOrder = JSON.parse(localStorage.getItem(orderKey)) || [];

            if (savedOrder.length > 0) {
              items.sort((a, b) => {
                const indexA = savedOrder.indexOf(a.id);
                const indexB = savedOrder.indexOf(b.id);
                if (indexA === -1) return 1;
                if (indexB === -1) return -1;
                return indexA - indexB;
              });
            }
          }

          items.forEach((item) => {
            // Para productos, mostrar solo los con stock
            if (type === "product" && item.stock <= 0) return;

            const card = this.createTouchCard(item, type);
            container.appendChild(card);
          });
        },
      };

      // =============================================
      // SISTEMA DE FACTURACIÓN MEJORADO PARA 82mm
      // =============================================

      const InvoiceSystem = {
        generateInvoice: function (type, cartData, total, extras = {}) {
          const invoiceNumber = `FAC-${Date.now().toString().slice(-6)}`;
          const currentDate = new Date();
          const formattedDate = currentDate.toLocaleDateString("es-DO");
          const formattedTime = currentDate.toLocaleTimeString("es-DO", {
            hour: "2-digit",
            minute: "2-digit",
          });

          // RNC por defecto 133577461
          const rnc = extras.rnc || "133577461";
          const formattedRNC = rnc ? this.formatRNC(rnc) : "CONSUMIDOR FINAL";
          const metodoPago = extras.metodo_pago || "Efectivo";
          const aprobacion = extras.aprobacion || "";
          const cliente = extras.cliente || "Cliente no registrado";

          // Obtener configuración de empresa
          const companyName =
            localStorage.getItem("company_name") || "STARK CLEANE";
          const companyAddress =
            localStorage.getItem("company_address") ||
            "Dirección no configurada";
          const companyPhone =
            localStorage.getItem("company_phone") || "Teléfono no configurado";
          const companyRNC = localStorage.getItem("company_rnc") || "133577461";

          let invoiceHTML = `
                    <div class="invoice-header">
                        <div class="invoice-logo">${companyName}</div>
                        <div class="invoice-company">SISTEMA INTEGRADO DE GESTIÓN</div>
                        <div class="invoice-address">${companyAddress}</div>
                        <div class="invoice-phone">Tel: ${companyPhone}</div>
                        <div class="invoice-rnc">RNC: ${companyRNC}</div>
                    </div>
                    
                    <div class="invoice-details">
                        <div><strong>FACTURA:</strong> ${invoiceNumber}</div>
                        <div><strong>FECHA:</strong> ${formattedDate} ${formattedTime}</div>
                        <div><strong>CLIENTE:</strong> ${cliente}</div>
                        <div><strong>RNC:</strong> ${formattedRNC}</div>
                        <div><strong>MÉTODO PAGO:</strong> ${metodoPago}</div>
                    </div>
                    
                    <div class="invoice-items">
                `;

          // Agregar items
          cartData.forEach((item, index) => {
            const itemName = item.name || item.nombre || "Producto";
            const itemPrice = item.price || item.precio || 0;
            const quantity = item.quantity || 1;
            const itemTotal = itemPrice * quantity;

            invoiceHTML += `
                        <div class="invoice-item">
                            <div class="invoice-item-name">${
                              index + 1
                            }. ${itemName}</div>
                            <div class="invoice-item-price">RD$ ${itemTotal.toFixed(
                              2
                            )}</div>
                        </div>
                        <div style="font-size: 9px; color: #666; margin-left: 10px;">
                            ${quantity} x RD$ ${itemPrice.toFixed(2)}
                        </div>
                    `;
          });

          invoiceHTML += `
                    </div>
                    
                    <div class="invoice-total">
                        <div style="display: flex; justify-content: space-between;">
                            <span>TOTAL:</span>
                            <span>RD$ ${total.toFixed(2)}</span>
                        </div>
                    </div>
                `;

          // Agregar sección de pago con tarjeta si aplica
          if (metodoPago.toLowerCase() === "tarjeta" && aprobacion) {
            invoiceHTML += this.generateCardPaymentSection(
              aprobacion,
              metodoPago
            );
          }

          invoiceHTML += `
                    <div class="invoice-footer">
                        <div>¡GRACIAS POR SU COMPRA!</div>
                        <div>Vuelva pronto</div>
                        <div class="invoice-number">${invoiceNumber}</div>
                        <div>Impreso: ${formattedDate} ${formattedTime}</div>
                    </div>
                `;

          return {
            html: invoiceHTML,
            number: invoiceNumber,
            date: currentDate.toISOString(),
            total: total,
            rnc: rnc,
            metodo_pago: metodoPago,
          };
        },

        formatRNC: function (rnc) {
          if (!rnc) return "CONSUMIDOR FINAL";
          // Formatear RNC: 133-577461
          const cleaned = rnc.replace(/\D/g, "");
          if (cleaned.length === 9) {
            return `${cleaned.substring(0, 3)}-${cleaned.substring(3)}`;
          }
          return cleaned;
        },

        generateCardPaymentSection: function (aprobacion, metodoPago) {
          return `
                    <div class="card-payment-section">
                        <div class="card-payment-header">COMPROBANTE DE PAGO</div>
                        <div class="card-payment-details">
                            <div class="card-payment-detail">
                                <span class="card-payment-label">MÉTODO:</span>
                                <span>${metodoPago}</span>
                            </div>
                            <div class="card-payment-detail">
                                <span class="card-payment-label">APROBACIÓN:</span>
                                <span>${aprobacion}</span>
                            </div>
                            <div class="card-payment-detail">
                                <span class="card-payment-label">FECHA:</span>
                                <span>${new Date().toLocaleDateString()}</span>
                            </div>
                            <div class="card-payment-detail">
                                <span class="card-payment-label">HORA:</span>
                                <span>${new Date().toLocaleTimeString()}</span>
                            </div>
                        </div>
                        <div class="card-payment-approval">
                            <i class="fas fa-check-circle"></i> TRANSACCIÓN APROBADA
                        </div>
                    </div>
                `;
        },

        printInvoice: function (invoiceHTML) {
          const invoiceContent = document.getElementById("invoiceContent");
          if (invoiceContent) {
            invoiceContent.innerHTML = invoiceHTML;

            // Mostrar modal
            const modal = document.getElementById("invoiceModal");
            modal.classList.add("active");

            // Configurar evento de impresión
            document.getElementById("printInvoiceBtn").onclick = function () {
              const printWindow = window.open("", "_blank");
              printWindow.document.write(`
                            <!DOCTYPE html>
                            <html>
                            <head>
                                <title>Factura STARK CLEANE</title>
                                <style>
                                    body { 
                                        font-family: 'Courier New', monospace; 
                                        font-size: 11px;
                                        margin: 0;
                                        padding: 10px;
                                        width: 82mm;
                                    }
                                    .invoice-header { text-align: center; margin-bottom: 8px; }
                                    .invoice-logo { font-size: 18px; font-weight: bold; }
                                    .invoice-items { width: 100%; margin: 10px 0; }
                                    .invoice-item { display: flex; justify-content: space-between; margin-bottom: 4px; }
                                    .invoice-total { border-top: 2px solid #000; padding-top: 8px; margin-top: 10px; font-weight: bold; }
                                    @media print { 
                                        body { width: 82mm !important; margin: 0 !important; padding: 10px !important; }
                                        .no-print { display: none !important; }
                                    }
                                </style>
                            </head>
                            <body>
                                ${invoiceHTML}
                            </body>
                            </html>
                        `);
              printWindow.document.close();
              printWindow.focus();
              setTimeout(() => {
                printWindow.print();
                printWindow.close();
              }, 250);
            };
          }
        },
      };

      // =============================================
      // SISTEMA DE COMANDOS PERSONALIZADOS JARVIS
      // =============================================

      const JarvisCommandsSystem = {
        init: function () {
          this.loadCommands();
          this.setupEventListeners();
        },

        setupEventListeners: function () {
          // Mostrar/ocultar sección de código personalizado
          document
            .getElementById("command-action")
            .addEventListener("change", function () {
              const customCodeSection = document.getElementById(
                "custom-code-section"
              );
              if (this.value === "custom_code") {
                customCodeSection.style.display = "block";
              } else {
                customCodeSection.style.display = "none";
              }
            });

          // Agregar nuevo comando
          document
            .getElementById("addCustomCommandBtn")
            .addEventListener("click", () => {
              this.addCustomCommand();
            });
        },

        loadCommands: function () {
          const commands = this.getCommands();
          const container = document.getElementById("custom-commands-list");

          if (!container) return;

          container.innerHTML = "";

          if (commands.length === 0) {
            container.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
                            <i class="fas fa-robot" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>No hay comandos personalizados configurados</p>
                            <p class="small">Agrega tu primer comando usando el formulario superior</p>
                        </div>
                    `;
            return;
          }

          commands.forEach((command, index) => {
            const commandEl = document.createElement("div");
            commandEl.className = "command-item";
            commandEl.innerHTML = `
                        <div>
                            <div class="command-header">
                                <span class="command-trigger">"${
                                  command.trigger
                                }"</span>
                                <span class="badge ${this.getActionBadgeClass(
                                  command.action
                                )}">${this.getActionText(command.action)}</span>
                            </div>
                            <p style="margin: 5px 0; color: var(--text-secondary);">${
                              command.description
                            }</p>
                            ${
                              command.page
                                ? `<small><i class="fas fa-arrow-right"></i> ${command.page}</small>`
                                : ""
                            }
                        </div>
                        <div class="command-actions">
                            <button class="command-action-btn" onclick="JarvisCommandsSystem.editCommand(${index})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="command-action-btn" onclick="JarvisCommandsSystem.deleteCommand(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
            container.appendChild(commandEl);
          });
        },

        getActionBadgeClass: function (action) {
          const classes = {
            open_page: "badge-info",
            create_sale: "badge-success",
            generate_report: "badge-warning",
            search_item: "badge-primary",
            custom_code: "badge-secondary",
          };
          return classes[action] || "badge-info";
        },

        getActionText: function (action) {
          const texts = {
            open_page: "Abrir Página",
            create_sale: "Crear Venta",
            generate_report: "Generar Reporte",
            search_item: "Buscar Item",
            custom_code: "Código Personalizado",
          };
          return texts[action] || action;
        },

        getCommands: function () {
          return (
            JSON.parse(localStorage.getItem("jarvis_custom_commands")) || []
          );
        },

        saveCommands: function (commands) {
          localStorage.setItem(
            "jarvis_custom_commands",
            JSON.stringify(commands)
          );
        },

        addCustomCommand: function () {
          const trigger = document
            .getElementById("command-trigger")
            .value.trim();
          const action = document.getElementById("command-action").value;
          const page = document.getElementById("command-page").value;
          const description = document
            .getElementById("command-description")
            .value.trim();
          const customCode = document
            .getElementById("command-custom-code")
            .value.trim();

          if (!trigger) {
            showNotification("El comando de voz es requerido", "error");
            return;
          }

          if (!description) {
            showNotification("La descripción es requerida", "error");
            return;
          }

          const commands = this.getCommands();

          // Verificar si ya existe
          if (
            commands.some(
              (cmd) => cmd.trigger.toLowerCase() === trigger.toLowerCase()
            )
          ) {
            showNotification("Este comando ya existe", "error");
            return;
          }

          const newCommand = {
            id: Date.now(),
            trigger: trigger,
            action: action,
            page: action === "open_page" ? page : null,
            description: description,
            customCode: action === "custom_code" ? customCode : null,
            created: new Date().toISOString(),
          };

          commands.push(newCommand);
          this.saveCommands(commands);
          this.loadCommands();

          // Limpiar formulario
          document.getElementById("command-trigger").value = "";
          document.getElementById("command-description").value = "";
          document.getElementById("command-custom-code").value = "";

          showNotification("Comando agregado exitosamente", "success");
        },

        editCommand: function (index) {
          const commands = this.getCommands();
          const command = commands[index];

          if (!command) return;

          // Llenar formulario con datos del comando
          document.getElementById("command-trigger").value = command.trigger;
          document.getElementById("command-action").value = command.action;
          document.getElementById("command-page").value = command.page || "";
          document.getElementById("command-description").value =
            command.description;
          document.getElementById("command-custom-code").value =
            command.customCode || "";

          // Mostrar/ocultar sección de código
          const customCodeSection = document.getElementById(
            "custom-code-section"
          );
          customCodeSection.style.display =
            command.action === "custom_code" ? "block" : "none";

          // Cambiar texto del botón
          const addBtn = document.getElementById("addCustomCommandBtn");
          const originalText = addBtn.innerHTML;
          addBtn.innerHTML = '<i class="fas fa-save"></i> Actualizar Comando';
          addBtn.onclick = function () {
            // Actualizar comando
            commands[index] = {
              ...command,
              trigger: document.getElementById("command-trigger").value.trim(),
              action: document.getElementById("command-action").value,
              page:
                document.getElementById("command-action").value === "open_page"
                  ? document.getElementById("command-page").value
                  : null,
              description: document
                .getElementById("command-description")
                .value.trim(),
              customCode:
                document.getElementById("command-action").value ===
                "custom_code"
                  ? document.getElementById("command-custom-code").value.trim()
                  : null,
            };

            JarvisCommandsSystem.saveCommands(commands);
            JarvisCommandsSystem.loadCommands();

            // Restaurar botón
            addBtn.innerHTML = originalText;
            addBtn.onclick = () => JarvisCommandsSystem.addCustomCommand();

            // Limpiar formulario
            document.getElementById("command-trigger").value = "";
            document.getElementById("command-description").value = "";
            document.getElementById("command-custom-code").value = "";

            showNotification("Comando actualizado", "success");
          };
        },

        deleteCommand: function (index) {
          if (confirm("¿Estás seguro de eliminar este comando?")) {
            const commands = this.getCommands();
            commands.splice(index, 1);
            this.saveCommands(commands);
            this.loadCommands();
            showNotification("Comando eliminado", "success");
          }
        },

        executeCommand: function (trigger) {
          const commands = this.getCommands();
          const command = commands.find(
            (cmd) => cmd.trigger.toLowerCase() === trigger.toLowerCase()
          );

          if (!command) return false;

          switch (command.action) {
            case "open_page":
              if (command.page) {
                showPage(command.page);
                showNotification(`Abriendo ${command.page}`, "success");
              }
              break;

            case "create_sale":
              // Lógica para crear venta
              showNotification("Creando nueva venta...", "info");
              break;

            case "generate_report":
              // Lógica para generar reporte
              showNotification("Generando reporte...", "info");
              break;

            case "search_item":
              // Lógica para buscar
              showNotification("Buscando...", "info");
              break;

            case "custom_code":
              try {
                // Ejecutar código JavaScript personalizado
                eval(command.customCode);
                showNotification("Comando personalizado ejecutado", "success");
              } catch (error) {
                showNotification(`Error en comando: ${error.message}`, "error");
              }
              break;
          }

          return true;
        },
      };

      // =============================================
      // SISTEMA DE BASE DE DATOS LOCAL CORREGIDO
      // =============================================

      const DB = {
        get: (key) => {
          try {
            const data = JSON.parse(localStorage.getItem(key)) || [];
            // Si es un array de servicios, aplicar orden
            if (key === "barberia_services" || key === "carwash_services") {
              const orderKey = key + "_order";
              const savedOrder =
                JSON.parse(localStorage.getItem(orderKey)) || [];
              if (savedOrder.length > 0) {
                return data.sort((a, b) => {
                  const indexA = savedOrder.indexOf(a.id);
                  const indexB = savedOrder.indexOf(b.id);
                  if (indexA === -1) return 1;
                  if (indexB === -1) return -1;
                  return indexA - indexB;
                });
              }
            }
            return data;
          } catch (error) {
            console.error("Error reading from localStorage:", error);
            return [];
          }
        },

        set: (key, data) => {
          try {
            localStorage.setItem(key, JSON.stringify(data));
            return true;
          } catch (error) {
            console.error("Error writing to localStorage:", error);
            return false;
          }
        },

        add: (key, item) => {
          const data = DB.get(key);
          item.id = Date.now();
          data.push(item);
          return DB.set(key, data) ? item.id : null;
        },

        update: (key, id, updates) => {
          const data = DB.get(key);
          const index = data.findIndex((item) => item.id === id);
          if (index !== -1) {
            data[index] = { ...data[index], ...updates };
            return DB.set(key, data);
          }
          return false;
        },

        delete: (key, id) => {
          const data = DB.get(key);
          const filtered = data.filter((item) => item.id !== id);
          return DB.set(key, filtered);
        },

        // Método para cargar datos iniciales
        initializeData: function () {
          // Servicios de barbería por defecto
          if (!localStorage.getItem("barberia_services")) {
            const defaultBarberiaServices = [
              {
                id: 1,
                nombre: "Corte de Cabello",
                precio: 250,
                descripcion: "Corte básico",
              },
              {
                id: 2,
                nombre: "Afeitado",
                precio: 150,
                descripcion: "Afeitado con navaja",
              },
              {
                id: 3,
                nombre: "Corte y Barba",
                precio: 350,
                descripcion: "Corte completo",
              },
              {
                id: 4,
                nombre: "Corte Niño",
                precio: 200,
                descripcion: "Corte para niños",
              },
              {
                id: 5,
                nombre: "Tinte",
                precio: 400,
                descripcion: "Aplicación de tinte",
              },
            ];
            DB.set("barberia_services", defaultBarberiaServices);
          }

          // Servicios de car wash por defecto
          if (!localStorage.getItem("carwash_services")) {
            const defaultCarwashServices = [
              {
                id: 1,
                nombre: "Lavado Básico",
                precio: 250,
                descripcion: "Lavado exterior",
              },
              {
                id: 2,
                nombre: "Lavado Completo",
                precio: 450,
                descripcion: "Lavado interior y exterior",
              },
              {
                id: 3,
                nombre: "Lavado Motor",
                precio: 300,
                descripcion: "Limpieza de motor",
              },
              {
                id: 4,
                nombre: "Encerado",
                precio: 500,
                descripcion: "Encerado completo",
              },
              {
                id: 5,
                nombre: "Aspirado",
                precio: 200,
                descripcion: "Aspirado interior",
              },
            ];
            DB.set("carwash_services", defaultCarwashServices);
          }

          // Productos por defecto
          if (!localStorage.getItem("productos")) {
            const defaultProducts = [
              {
                id: 1,
                nombre: "Refresco Cola",
                codigo: "COL001",
                precio_compra: 80,
                precio_venta: 100,
                stock: 50,
                categoria: "bebidas",
              },
              {
                id: 2,
                nombre: "Agua Mineral",
                codigo: "AGU001",
                precio_compra: 40,
                precio_venta: 50,
                stock: 30,
                categoria: "bebidas",
              },
              {
                id: 3,
                nombre: "Papas Fritas",
                codigo: "PAP001",
                precio_compra: 60,
                precio_venta: 80,
                stock: 25,
                categoria: "snacks",
              },
              {
                id: 4,
                nombre: "Chocolate",
                codigo: "CHO001",
                precio_compra: 70,
                precio_venta: 90,
                stock: 20,
                categoria: "snacks",
              },
              {
                id: 5,
                nombre: "Cerveza",
                codigo: "CER001",
                precio_compra: 120,
                precio_venta: 150,
                stock: 40,
                categoria: "bebidas",
              },
            ];
            DB.set("productos", defaultProducts);
          }

          // Empleados por defecto
          if (!localStorage.getItem("empleados")) {
            const defaultEmployees = [
              {
                id: 1,
                nombre: "Juan Pérez",
                cedula: "001-1234567-8",
                telefono: "809-123-4567",
                cargo: "barbero",
                sueldo: 25000,
              },
              {
                id: 2,
                nombre: "María García",
                cedula: "002-2345678-9",
                telefono: "809-234-5678",
                cargo: "lavador",
                sueldo: 20000,
              },
              {
                id: 3,
                nombre: "Carlos Rodríguez",
                cedula: "003-3456789-0",
                telefono: "809-345-6789",
                cargo: "vendedor",
                sueldo: 18000,
              },
            ];
            DB.set("empleados", defaultEmployees);
          }

          // Otros datos iniciales
          if (!localStorage.getItem("billar_sales")) DB.set("billar_sales", []);
          if (!localStorage.getItem("barberia_sales"))
            DB.set("barberia_sales", []);
          if (!localStorage.getItem("carwash_sales"))
            DB.set("carwash_sales", []);
          if (!localStorage.getItem("barberia_appointments"))
            DB.set("barberia_appointments", []);
          if (!localStorage.getItem("carwash_vehicles"))
            DB.set("carwash_vehicles", []);
          if (!localStorage.getItem("cash_closings"))
            DB.set("cash_closings", []);
          if (!localStorage.getItem("sync_history")) DB.set("sync_history", []);
          if (!localStorage.getItem("clients")) DB.set("clients", []);
        },
      };

      // =============================================
      // FUNCIONES DE NOTIFICACIÓN
      // =============================================

      function showNotification(message, type = "success") {
        // Eliminar notificaciones existentes
        document.querySelectorAll(".notification").forEach((n) => n.remove());

        const notification = document.createElement("div");
        notification.className = `notification ${type}`;
        notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${
                      type === "success"
                        ? "check-circle"
                        : type === "error"
                        ? "exclamation-circle"
                        : type === "warning"
                        ? "exclamation-triangle"
                        : "info-circle"
                    }"></i>
                    <span>${message}</span>
                </div>
            `;
        document.body.appendChild(notification);

        // Auto-eliminar después de 3 segundos
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 3000);
      }

      // =============================================
      // SISTEMA DE CARRITO DE COMPRAS
      // =============================================

      let cart = [];
      let cartBarberia = [];
      let cartCarwash = [];

      function addToCart(id, name, price) {
        const existingItem = cart.find((item) => item.id === id);

        if (existingItem) {
          existingItem.quantity++;
        } else {
          cart.push({
            id: id,
            name: name,
            price: parseFloat(price),
            quantity: 1,
          });
        }

        updateCartUI();
        showNotification(`${name} agregado al carrito`, "success");
      }

      function updateCartUI() {
        const cartItems = document.getElementById("cartItems");
        const cartCount = document.getElementById("cartCount");
        const cartTotal = document.getElementById("cartTotal");

        if (!cartItems) return;

        cartItems.innerHTML = "";
        let total = 0;

        cart.forEach((item) => {
          const itemTotal = item.price * item.quantity;
          total += itemTotal;

          const cartItem = document.createElement("div");
          cartItem.className = "cart-item";
          cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">RD$ ${item.price} c/u</div>
                    </div>
                    <div class="cart-item-actions">
                        <button class="quantity-btn" onclick="decreaseQuantity(${
                          item.id
                        })">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn" onclick="increaseQuantity(${
                          item.id
                        })">+</button>
                    </div>
                    <div>RD$ ${itemTotal.toFixed(2)}</div>
                `;
          cartItems.appendChild(cartItem);
        });

        if (cartCount) cartCount.textContent = `${cart.length} productos`;
        if (cartTotal) cartTotal.textContent = `Total: RD$ ${total.toFixed(2)}`;

        updateChange();
      }

      function increaseQuantity(id) {
        const item = cart.find((item) => item.id === id);
        if (item) {
          // Verificar stock
          const products = DB.get("productos");
          const product = products.find((p) => p.id === id);

          if (product && item.quantity >= product.stock) {
            showNotification(
              `No hay suficiente stock. Máximo: ${product.stock}`,
              "error"
            );
            return;
          }

          item.quantity++;
          updateCartUI();
        }
      }

      function decreaseQuantity(id) {
        const itemIndex = cart.findIndex((item) => item.id === id);
        if (itemIndex !== -1) {
          if (cart[itemIndex].quantity > 1) {
            cart[itemIndex].quantity--;
          } else {
            cart.splice(itemIndex, 1);
          }
          updateCartUI();
        }
      }

      function getCartTotal() {
        return cart.reduce(
          (total, item) => total + item.price * item.quantity,
          0
        );
      }

      function updateChange() {
        const efectivoRecibido =
          parseFloat(document.getElementById("efectivo-recibido").value) || 0;
        const total = getCartTotal();
        const cambio = efectivoRecibido - total;
        const cambioDisplay = document.getElementById("cambio-display");
        const paymentValidation = document.getElementById("paymentValidation");

        if (cambioDisplay) {
          if (cambio >= 0) {
            cambioDisplay.textContent = `Cambio: RD$ ${cambio.toFixed(2)}`;
            cambioDisplay.style.color = "var(--accent)";
          } else {
            cambioDisplay.textContent = `Falta: RD$ ${Math.abs(cambio).toFixed(
              2
            )}`;
            cambioDisplay.style.color = "var(--danger)";
          }
        }

        if (paymentValidation) {
          if (efectivoRecibido > 0 && efectivoRecibido < total) {
            paymentValidation.classList.add("show");
          } else {
            paymentValidation.classList.remove("show");
          }
        }
      }

      // Funciones similares para barbería y carwash
      function addToCartBarberia(id, name, price, description) {
        const existingItem = cartBarberia.find((item) => item.id === id);

        if (existingItem) {
          existingItem.quantity++;
        } else {
          cartBarberia.push({
            id: id,
            name: name,
            price: parseFloat(price),
            description: description,
            quantity: 1,
          });
        }

        updateCartUIBarberia();
      }

      function updateCartUIBarberia() {
        const cartItems = document.getElementById("cartItemsBarberia");
        const cartCount = document.getElementById("cartCountBarberia");
        const cartTotal = document.getElementById("cartTotalBarberia");

        if (!cartItems) return;

        cartItems.innerHTML = "";
        let total = 0;

        cartBarberia.forEach((item) => {
          const itemTotal = item.price * item.quantity;
          total += itemTotal;

          const cartItem = document.createElement("div");
          cartItem.className = "cart-item";
          cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">RD$ ${item.price} c/u</div>
                        ${
                          item.description
                            ? `<small style="color: var(--text-secondary);">${item.description}</small>`
                            : ""
                        }
                    </div>
                    <div class="cart-item-actions">
                        <button class="quantity-btn" onclick="decreaseQuantityBarberia(${
                          item.id
                        })">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn" onclick="increaseQuantityBarberia(${
                          item.id
                        })">+</button>
                    </div>
                    <div>RD$ ${itemTotal.toFixed(2)}</div>
                `;
          cartItems.appendChild(cartItem);
        });

        if (cartCount)
          cartCount.textContent = `${cartBarberia.length} servicios`;
        if (cartTotal) cartTotal.textContent = `Total: RD$ ${total.toFixed(2)}`;

        updateChangeBarberia();
      }

      function increaseQuantityBarberia(id) {
        const item = cartBarberia.find((item) => item.id === id);
        if (item) {
          item.quantity++;
          updateCartUIBarberia();
        }
      }

      function decreaseQuantityBarberia(id) {
        const itemIndex = cartBarberia.findIndex((item) => item.id === id);
        if (itemIndex !== -1) {
          if (cartBarberia[itemIndex].quantity > 1) {
            cartBarberia[itemIndex].quantity--;
          } else {
            cartBarberia.splice(itemIndex, 1);
          }
          updateCartUIBarberia();
        }
      }

      function getCartTotalBarberia() {
        return cartBarberia.reduce(
          (total, item) => total + item.price * item.quantity,
          0
        );
      }

      function updateChangeBarberia() {
        const efectivoRecibido =
          parseFloat(
            document.getElementById("efectivo-recibido-barberia").value
          ) || 0;
        const total = getCartTotalBarberia();
        const cambio = efectivoRecibido - total;
        const cambioDisplay = document.getElementById(
          "cambio-display-barberia"
        );
        const paymentValidation = document.getElementById(
          "paymentValidationBarberia"
        );

        if (cambioDisplay) {
          if (cambio >= 0) {
            cambioDisplay.textContent = `Cambio: RD$ ${cambio.toFixed(2)}`;
            cambioDisplay.style.color = "var(--accent)";
          } else {
            cambioDisplay.textContent = `Falta: RD$ ${Math.abs(cambio).toFixed(
              2
            )}`;
            cambioDisplay.style.color = "var(--danger)";
          }
        }

        if (paymentValidation) {
          if (efectivoRecibido > 0 && efectivoRecibido < total) {
            paymentValidation.classList.add("show");
          } else {
            paymentValidation.classList.remove("show");
          }
        }
      }

      // Funciones para carwash (similares a barbería)
      function addToCartCarwash(id, name, price, description) {
        const existingItem = cartCarwash.find((item) => item.id === id);

        if (existingItem) {
          existingItem.quantity++;
        } else {
          cartCarwash.push({
            id: id,
            name: name,
            price: parseFloat(price),
            description: description,
            quantity: 1,
          });
        }

        updateCartUICarwash();
      }

      function updateCartUICarwash() {
        const cartItems = document.getElementById("cartItemsCarwash");
        const cartCount = document.getElementById("cartCountCarwash");
        const cartTotal = document.getElementById("cartTotalCarwash");

        if (!cartItems) return;

        cartItems.innerHTML = "";
        let total = 0;

        cartCarwash.forEach((item) => {
          const itemTotal = item.price * item.quantity;
          total += itemTotal;

          const cartItem = document.createElement("div");
          cartItem.className = "cart-item";
          cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">RD$ ${item.price} c/u</div>
                        ${
                          item.description
                            ? `<small style="color: var(--text-secondary);">${item.description}</small>`
                            : ""
                        }
                    </div>
                    <div class="cart-item-actions">
                        <button class="quantity-btn" onclick="decreaseQuantityCarwash(${
                          item.id
                        })">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn" onclick="increaseQuantityCarwash(${
                          item.id
                        })">+</button>
                    </div>
                    <div>RD$ ${itemTotal.toFixed(2)}</div>
                `;
          cartItems.appendChild(cartItem);
        });

        if (cartCount)
          cartCount.textContent = `${cartCarwash.length} servicios`;
        if (cartTotal) cartTotal.textContent = `Total: RD$ ${total.toFixed(2)}`;

        updateChangeCarwash();
      }

      function increaseQuantityCarwash(id) {
        const item = cartCarwash.find((item) => item.id === id);
        if (item) {
          item.quantity++;
          updateCartUICarwash();
        }
      }

      function decreaseQuantityCarwash(id) {
        const itemIndex = cartCarwash.findIndex((item) => item.id === id);
        if (itemIndex !== -1) {
          if (cartCarwash[itemIndex].quantity > 1) {
            cartCarwash[itemIndex].quantity--;
          } else {
            cartCarwash.splice(itemIndex, 1);
          }
          updateCartUICarwash();
        }
      }

      function getCartTotalCarwash() {
        return cartCarwash.reduce(
          (total, item) => total + item.price * item.quantity,
          0
        );
      }

      function updateChangeCarwash() {
        const efectivoRecibido =
          parseFloat(
            document.getElementById("efectivo-recibido-carwash").value
          ) || 0;
        const total = getCartTotalCarwash();
        const cambio = efectivoRecibido - total;
        const cambioDisplay = document.getElementById("cambio-display-carwash");
        const paymentValidation = document.getElementById(
          "paymentValidationCarwash"
        );

        if (cambioDisplay) {
          if (cambio >= 0) {
            cambioDisplay.textContent = `Cambio: RD$ ${cambio.toFixed(2)}`;
            cambioDisplay.style.color = "var(--accent)";
          } else {
            cambioDisplay.textContent = `Falta: RD$ ${Math.abs(cambio).toFixed(
              2
            )}`;
            cambioDisplay.style.color = "var(--danger)";
          }
        }

        if (paymentValidation) {
          if (efectivoRecibido > 0 && efectivoRecibido < total) {
            paymentValidation.classList.add("show");
          } else {
            paymentValidation.classList.remove("show");
          }
        }
      }

      // =============================================
      // FUNCIONES DE FACTURACIÓN UNIFICADAS
      // =============================================

      function printInvoice(
        type = "billar",
        cartData = [],
        total = 0,
        extras = {}
      ) {
        const invoice = InvoiceSystem.generateInvoice(
          type,
          cartData,
          total,
          extras
        );
        InvoiceSystem.printInvoice(invoice.html);

        // Guardar venta en historial
        const saleRecord = {
          id: Date.now(),
          numero: invoice.number,
          tipo: type,
          items: cartData,
          total: total,
          rnc: invoice.rnc,
          metodo_pago: invoice.metodo_pago,
          cliente: extras.cliente || "Cliente no registrado",
          fecha: invoice.date,
          usuario: document.getElementById("currentUserName").textContent,
        };

        if (type === "billar") {
          DB.add("billar_sales", saleRecord);

          // Actualizar stock de productos
          cartData.forEach((item) => {
            const products = DB.get("productos");
            const productIndex = products.findIndex((p) => p.id === item.id);
            if (productIndex !== -1) {
              products[productIndex].stock -= item.quantity;
              DB.set("productos", products);
            }
          });
        } else if (type === "barberia") {
          DB.add("barberia_sales", saleRecord);
        } else if (type === "carwash") {
          DB.add("carwash_sales", saleRecord);
        }

        // Limpiar carrito después de facturar
        if (type === "billar") {
          cart = [];
          updateCartUI();
        } else if (type === "barberia") {
          cartBarberia = [];
          updateCartUIBarberia();
        } else if (type === "carwash") {
          cartCarwash = [];
          updateCartUICarwash();
        }

        showNotification(`Factura ${invoice.number} generada`, "success");
        return invoice.number;
      }

      // =============================================
      // FUNCIONES DE CARGA DE DATOS - CORREGIDAS
      // =============================================

      function loadBarberiaServices() {
        const services = DB.get("barberia_services");
        TouchSystem.loadTouchServices(
          "barberia-touch-container",
          services,
          "barberia"
        );

        // También cargar en select de citas
        const select = document.getElementById("servicio-cita");
        if (select) {
          select.innerHTML = '<option value="">Seleccione un servicio</option>';
          services.forEach((service) => {
            const option = document.createElement("option");
            option.value = service.id;
            option.textContent = `${service.nombre} - RD$ ${service.precio}`;
            select.appendChild(option);
          });
        }
      }

      function loadCarwashServices() {
        const services = DB.get("carwash_services");
        TouchSystem.loadTouchServices(
          "carwash-touch-container",
          services,
          "carwash"
        );
      }

      function loadBillarProducts() {
        const products = DB.get("productos");
        TouchSystem.loadTouchServices(
          "billar-products-touch",
          products,
          "product"
        );

        // También cargar en tabla
        const table = document.getElementById("productsTable");
        if (table) {
          table.innerHTML = "";

          products.forEach((product) => {
            const row = document.createElement("tr");
            const estado =
              product.stock <= 0
                ? "danger"
                : product.stock <= 5
                ? "warning"
                : "success";
            const estadoText =
              product.stock <= 0
                ? "Sin stock"
                : product.stock <= 5
                ? "Bajo stock"
                : "Disponible";

            row.innerHTML = `
                        <td>${product.codigo || "-"}</td>
                        <td>${product.nombre}</td>
                        <td>${product.categoria}</td>
                        <td>RD$ ${product.precio_compra}</td>
                        <td>RD$ ${product.precio_venta}</td>
                        <td>${product.stock}</td>
                        <td><span class="badge badge-${estado}">${estadoText}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline" onclick="editProduct(${
                              product.id
                            })">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${
                              product.id
                            })">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
            table.appendChild(row);
          });
        }
      }

      function loadConfigServices() {
        // Cargar servicios de barbería
        const barberiaServices = DB.get("barberia_services");
        const barberiaTable = document.getElementById(
          "barberia-servicios-lista"
        );

        if (barberiaTable) {
          barberiaTable.innerHTML = "";
          barberiaServices.forEach((service, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${service.nombre}</td>
                        <td>RD$ ${service.precio}</td>
                        <td>${service.descripcion || "-"}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline" onclick="editBarberiaService(${
                              service.id
                            })">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteBarberiaService(${
                              service.id
                            })">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
            barberiaTable.appendChild(row);
          });
        }

        // Cargar servicios de car wash
        const carwashServices = DB.get("carwash_services");
        const carwashTable = document.getElementById("carwash-servicios-lista");

        if (carwashTable) {
          carwashTable.innerHTML = "";
          carwashServices.forEach((service, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${service.nombre}</td>
                        <td>RD$ ${service.precio}</td>
                        <td>${service.descripcion || "-"}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline" onclick="editCarwashService(${
                              service.id
                            })">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCarwashService(${
                              service.id
                            })">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
            carwashTable.appendChild(row);
          });
        }
      }

      function loadConfigProducts() {
        const products = DB.get("productos");
        const table = document.getElementById("productos-lista");

        if (table) {
          table.innerHTML = "";
          products.forEach((product) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                        <td>${product.nombre}</td>
                        <td>${product.codigo || "-"}</td>
                        <td>RD$ ${product.precio_compra}</td>
                        <td>RD$ ${product.precio_venta}</td>
                        <td>${product.stock}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline" onclick="editProduct(${
                              product.id
                            })">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${
                              product.id
                            })">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
            table.appendChild(row);
          });
        }
      }

      function loadConfigUsers() {
        const users = UserSystem.getUsers();
        const table = document.getElementById("usersTable");

        if (table) {
          table.innerHTML = "";
          users.forEach((user) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                        <td>${user.username}</td>
                        <td>${
                          user.role === "admin" ? "Administrador" : "Vendedor"
                        }</td>
                        <td>${new Date(user.created).toLocaleDateString()}</td>
                        <td><span class="badge badge-success">Activo</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-danger" onclick="deleteUser(${
                              user.id
                            })" ${user.username === "admin" ? "disabled" : ""}>
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
            table.appendChild(row);
          });
        }
      }

      function loadConfigEmployees() {
        const employees = DB.get("empleados");
        const grid = document.getElementById("employeesGrid");

        if (grid) {
          grid.innerHTML = "";
          employees.forEach((employee) => {
            const card = document.createElement("div");
            card.className = "employee-card";
            card.innerHTML = `
                        <div class="employee-header">
                            <div class="employee-avatar">${employee.nombre.charAt(
                              0
                            )}</div>
                            <div>
                                <h4>${employee.nombre}</h4>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">${
                                  employee.cargo
                                }</p>
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                            <p><i class="fas fa-id-card"></i> ${
                              employee.cedula
                            }</p>
                            <p><i class="fas fa-phone"></i> ${
                              employee.telefono
                            }</p>
                            <p><i class="fas fa-money-bill"></i> RD$ ${
                              employee.sueldo
                            }</p>
                        </div>
                        <div class="action-buttons" style="margin-top: 15px;">
                            <button class="btn btn-sm btn-outline" onclick="editEmployee(${
                              employee.id
                            })">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${
                              employee.id
                            })">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
            grid.appendChild(card);
          });
        }

        // También cargar en selects
        const selects = ["empleado-vehiculo", "barbero-cita"];
        selects.forEach((selectId) => {
          const select = document.getElementById(selectId);
          if (select) {
            select.innerHTML = '<option value="">Seleccione empleado</option>';
            employees.forEach((employee) => {
              const option = document.createElement("option");
              option.value = employee.id;
              option.textContent = `${employee.nombre} (${employee.cargo})`;
              select.appendChild(option);
            });
          }
        });
      }

      // =============================================
      // NUEVAS FUNCIONES PARA HISTORIALES
      // =============================================

      function loadBarberiaHistory() {
        const sales = DB.get("barberia_sales");
        const table = document.getElementById("barberiaHistoryTable");

        if (!table) return;

        table.innerHTML = "";

        if (sales.length === 0) {
          table.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px; color: var(--text-secondary);">
                            No hay ventas registradas en barbería
                        </td>
                    </tr>
                `;
          return;
        }

        // Ordenar por fecha más reciente
        sales.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

        sales.forEach((sale) => {
          const row = document.createElement("tr");
          const date = new Date(sale.fecha);
          const formattedDate = date.toLocaleDateString();
          const formattedTime = date.toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit",
          });

          // Crear lista de servicios
          const servicesList = sale.items
            .map(
              (item) => `${item.name || item.nombre} (${item.quantity || 1})`
            )
            .join(", ");

          row.innerHTML = `
                    <td>${formattedDate} ${formattedTime}</td>
                    <td>${sale.cliente || "Cliente no registrado"}</td>
                    <td>${servicesList}</td>
                    <td>RD$ ${sale.total.toFixed(2)}</td>
                    <td>${sale.metodo_pago || "Efectivo"}</td>
                    <td>${sale.rnc || "Consumidor Final"}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline" onclick="reprintInvoice('${
                          sale.numero
                        }', 'barberia')">
                            <i class="fas fa-print"></i>
                        </button>
                    </td>
                `;
          table.appendChild(row);
        });
      }

      function loadCarwashHistory() {
        const sales = DB.get("carwash_sales");
        const table = document.getElementById("carwashHistoryTable");

        if (!table) return;

        table.innerHTML = "";

        if (sales.length === 0) {
          table.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px; color: var(--text-secondary);">
                            No hay servicios registrados
                        </td>
                    </tr>
                `;
          return;
        }

        // Ordenar por fecha más reciente
        sales.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

        sales.forEach((sale) => {
          const row = document.createElement("tr");
          const date = new Date(sale.fecha);
          const formattedDate = date.toLocaleDateString();

          // Crear lista de servicios
          const servicesList = sale.items
            .map(
              (item) => `${item.name || item.nombre} (${item.quantity || 1})`
            )
            .join(", ");

          row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${sale.vehiculo || "Vehículo no registrado"}</td>
                    <td>${sale.tipo || "N/A"}</td>
                    <td>${servicesList}</td>
                    <td>RD$ ${sale.total.toFixed(2)}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline" onclick="reprintInvoice('${
                          sale.numero
                        }', 'carwash')">
                            <i class="fas fa-print"></i>
                        </button>
                    </td>
                `;
          table.appendChild(row);
        });
      }

      function loadCashClosingHistory() {
        const closings = DB.get("cash_closings");
        const table = document.getElementById("closingHistoryTable");

        if (!table) return;

        table.innerHTML = "";

        if (closings.length === 0) {
          table.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px; color: var(--text-secondary);">
                            No hay cierres de caja registrados
                        </td>
                    </tr>
                `;
          return;
        }

        // Ordenar por fecha más reciente
        closings.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

        closings.forEach((closing) => {
          const row = document.createElement("tr");
          const date = new Date(closing.fecha);
          const formattedDate = date.toLocaleDateString();
          const formattedTime = date.toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit",
          });

          row.innerHTML = `
                    <td>${formattedDate} ${formattedTime}</td>
                    <td>${closing.responsable || "No especificado"}</td>
                    <td>RD$ ${closing.efectivo_contado || 0}</td>
                    <td>RD$ ${closing.tarjeta || 0}</td>
                    <td>RD$ ${closing.transferencia || 0}</td>
                    <td>RD$ ${closing.total_esperado || 0}</td>
                    <td>
                        <span class="badge ${
                          closing.discrepancia
                            ? "badge-warning"
                            : "badge-success"
                        }">
                            ${
                              closing.discrepancia
                                ? "Con discrepancia"
                                : "Correcto"
                            }
                        </span>
                    </td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline" onclick="viewClosingDetails(${
                          closing.id
                        })">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
          table.appendChild(row);
        });
      }

      function loadCompletedVehicles() {
        const vehicles = DB.get("carwash_vehicles");
        const table = document.getElementById("completedVehiclesTable");

        if (!table) return;

        table.innerHTML = "";

        // Filtrar vehículos completados
        const completedVehicles = vehicles.filter(
          (v) => v.estado === "completado"
        );

        if (completedVehicles.length === 0) {
          table.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px; color: var(--text-secondary);">
                            No hay vehículos entregados
                        </td>
                    </tr>
                `;
          return;
        }

        // Ordenar por fecha más reciente
        completedVehicles.sort(
          (a, b) => new Date(b.salida) - new Date(a.salida)
        );

        completedVehicles.forEach((vehicle) => {
          const row = document.createElement("tr");
          const entrada = new Date(vehicle.entrada);
          const salida = new Date(vehicle.salida);

          row.innerHTML = `
                    <td>${vehicle.placa}</td>
                    <td>${vehicle.tipo}</td>
                    <td>${vehicle.cliente}</td>
                    <td>${
                      vehicle.servicios
                        ? vehicle.servicios.join(", ")
                        : "Ninguno"
                    }</td>
                    <td>RD$ ${vehicle.total || 0}</td>
                    <td>${entrada.toLocaleTimeString([], {
                      hour: "2-digit",
                      minute: "2-digit",
                    })}</td>
                    <td>${salida.toLocaleTimeString([], {
                      hour: "2-digit",
                      minute: "2-digit",
                    })}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline" onclick="viewVehicleDetails(${
                          vehicle.id
                        })">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
          table.appendChild(row);
        });
      }

      function loadAppointments() {
        const appointments = DB.get("barberia_appointments");
        const table = document.getElementById("appointmentsTable");

        if (!table) return;

        table.innerHTML = "";

        if (appointments.length === 0) {
          table.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px; color: var(--text-secondary);">
                            No hay citas programadas
                        </td>
                    </tr>
                `;
          return;
        }

        // Ordenar por fecha más reciente
        appointments.sort((a, b) => new Date(a.fecha) - new Date(b.fecha));

        appointments.forEach((appointment) => {
          const row = document.createElement("tr");
          const date = new Date(appointment.fecha);
          const formattedDate = date.toLocaleDateString();
          const formattedTime = date.toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit",
          });

          row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${formattedTime}</td>
                    <td>${appointment.cliente}</td>
                    <td>${appointment.servicio}</td>
                    <td>${appointment.barbero}</td>
                    <td><span class="badge badge-${
                      appointment.estado === "pendiente" ? "warning" : "success"
                    }">${appointment.estado}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-success" onclick="completeAppointment(${
                          appointment.id
                        })" ${
            appointment.estado === "completada" ? "disabled" : ""
          }>
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="cancelAppointment(${
                          appointment.id
                        })">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                `;
          table.appendChild(row);
        });
      }

      // =============================================
      // FUNCIONES PARA LOS BOTONES DE ACCIÓN
      // =============================================

      function saveVehicle() {
        const placa = document.getElementById("placa-vehiculo").value.trim();
        const tipo = document.getElementById("tipo-vehiculo").value;
        const cliente = document
          .getElementById("cliente-vehiculo")
          .value.trim();
        const telefono = document
          .getElementById("telefono-vehiculo")
          .value.trim();
        const empleadoId = document.getElementById("empleado-vehiculo").value;
        const notas = document.getElementById("notas-vehiculo").value.trim();

        if (!placa || !tipo || !cliente) {
          showNotification("Placa, tipo y cliente son requeridos", "error");
          return;
        }

        // Obtener nombre del empleado
        const empleados = DB.get("empleados");
        const empleado = empleados.find((e) => e.id == empleadoId);
        const empleadoNombre = empleado ? empleado.nombre : "No asignado";

        const newVehicle = {
          id: Date.now(),
          placa: placa,
          tipo: tipo,
          cliente: cliente,
          telefono: telefono,
          empleado: empleadoNombre,
          empleado_id: empleadoId || null,
          notas: notas,
          entrada: new Date().toISOString(),
          estado: "en_proceso",
          servicios: [],
        };

        DB.add("carwash_vehicles", newVehicle);
        showNotification("Vehículo registrado exitosamente", "success");

        // Limpiar formulario
        document.getElementById("placa-vehiculo").value = "";
        document.getElementById("tipo-vehiculo").value = "";
        document.getElementById("cliente-vehiculo").value = "";
        document.getElementById("telefono-vehiculo").value = "";
        document.getElementById("empleado-vehiculo").value = "";
        document.getElementById("notas-vehiculo").value = "";

        // Actualizar la vista si estamos en la página de carwash
        loadCarwashVehicles();
      }

      function saveAppointment() {
        const cliente = document.getElementById("cliente-cita").value.trim();
        const telefono = document.getElementById("telefono-cita").value.trim();
        const servicioId = document.getElementById("servicio-cita").value;
        const barberoId = document.getElementById("barbero-cita").value;
        const fecha = document.getElementById("fecha-cita").value;
        const hora = document.getElementById("hora-cita").value;
        const notas = document.getElementById("notas-cita").value.trim();

        if (!cliente || !servicioId || !barberoId || !fecha || !hora) {
          showNotification(
            "Cliente, servicio, barbero, fecha y hora son requeridos",
            "error"
          );
          return;
        }

        // Obtener nombre del servicio y barbero
        const servicios = DB.get("barberia_services");
        const servicio = servicios.find((s) => s.id == servicioId);

        const empleados = DB.get("empleados");
        const barbero = empleados.find((e) => e.id == barberoId);

        const newAppointment = {
          id: Date.now(),
          cliente: cliente,
          telefono: telefono,
          servicio: servicio ? servicio.nombre : "Servicio no especificado",
          servicio_id: servicioId,
          barbero: barbero ? barbero.nombre : "Barbero no especificado",
          barbero_id: barberoId,
          fecha: fecha + "T" + hora,
          notas: notas,
          estado: "pendiente",
        };

        DB.add("barberia_appointments", newAppointment);
        showNotification("Cita registrada exitosamente", "success");

        // Limpiar formulario
        document.getElementById("cliente-cita").value = "";
        document.getElementById("telefono-cita").value = "";
        document.getElementById("servicio-cita").value = "";
        document.getElementById("barbero-cita").value = "";
        document.getElementById("fecha-cita").value = "";
        document.getElementById("hora-cita").value = "";
        document.getElementById("notas-cita").value = "";

        // Actualizar la tabla de citas
        loadAppointments();
      }

      // =============================================
      // SISTEMA DE NAVEGACIÓN
      // =============================================

      function showPage(pageId) {
        // Ocultar todas las páginas
        document.querySelectorAll(".page").forEach((page) => {
          page.classList.remove("active");
        });

        // Mostrar página seleccionada
        const targetPage = document.getElementById(pageId);
        if (targetPage) {
          targetPage.classList.add("active");
        }

        // Actualizar menú activo
        document.querySelectorAll(".menu-item").forEach((item) => {
          item.classList.remove("active");
        });

        const activeItem = document.querySelector(`[data-page="${pageId}"]`);
        if (activeItem) {
          activeItem.classList.add("active");
        }

        // Actualizar título
        const titles = {
          dashboard: "Dashboard",
          barberia: "Barbería",
          billar: "Billar - Sistema POS",
          carwash: "Car Wash",
          "config-usuarios": "Configuración - Usuarios",
          "config-servicios": "Configuración - Servicios",
          "config-productos": "Configuración - Productos",
          "config-empleados": "Configuración - Empleados",
          "config-impresora": "Configuración - Impresora",
          "config-tema": "Configuración - Tema",
          "config-jarvis": "Configuración Jarvis",
          "config-cierre": "Cierre de Caja",
          "config-contabilidad": "Integración Contable",
        };

        document.getElementById("headerTitle").textContent =
          titles[pageId] || "STARK CLEANE";

        // Cargar datos específicos de la página
        switch (pageId) {
          case "dashboard":
            updateDashboard();
            break;
          case "barberia":
            loadBarberiaServices();
            loadBarberiaHistory();
            loadAppointments();
            break;
          case "carwash":
            loadCarwashServices();
            loadCarwashVehicles();
            loadCarwashHistory();
            loadCompletedVehicles();
            break;
          case "billar":
            loadBillarProducts();
            break;
          case "config-servicios":
            loadConfigServices();
            break;
          case "config-productos":
            loadConfigProducts();
            break;
          case "config-usuarios":
            loadConfigUsers();
            break;
          case "config-empleados":
            loadConfigEmployees();
            break;
          case "config-jarvis":
            JarvisCommandsSystem.loadCommands();
            break;
          case "config-cierre":
            loadCashClosingHistory();
            break;
        }
      }

      // =============================================
      // CONFIGURACIÓN DE EVENT LISTENERS (CORREGIDA)
      // =============================================

      function setupEventListeners() {
        // Navegación
        document.addEventListener("click", function (event) {
          // Menú principal
          if (event.target.closest("[data-page]")) {
            const pageElement = event.target.closest("[data-page]");
            const pageId = pageElement.getAttribute("data-page");

            if (pageElement.classList.contains("submenu-item")) {
              const parentSubmenu = pageElement.closest(".submenu");
              if (parentSubmenu) {
                parentSubmenu.classList.remove("active");
                const parentMenuItem = parentSubmenu.previousElementSibling;
                if (parentMenuItem) {
                  parentMenuItem
                    .querySelector(".fa-chevron-down")
                    .classList.remove("fa-chevron-up");
                }
              }
            }

            showPage(pageId);
          }

          // Submenús
          if (event.target.closest("[data-submenu]")) {
            const submenuElement = event.target.closest("[data-submenu]");
            const submenuId =
              submenuElement.getAttribute("data-submenu") + "-submenu";
            const submenu = document.getElementById(submenuId);
            submenu.classList.toggle("active");

            const chevron = submenuElement.querySelector(".fa-chevron-down");
            if (chevron) {
              chevron.classList.toggle("fa-chevron-up");
            }

            event.stopPropagation();
          }
        });

        // Tabs
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.addEventListener("click", function () {
            const tabId = this.getAttribute("data-tab");
            const container = this.closest(".tabs").parentElement;

            this.parentElement.querySelectorAll(".tab").forEach((t) => {
              t.classList.remove("active");
            });

            this.classList.add("active");

            container.querySelectorAll(".tab-content").forEach((content) => {
              content.classList.remove("active");
            });

            const targetContent = document.getElementById(tabId);
            if (targetContent) {
              targetContent.classList.add("active");
            }

            // Cargar datos específicos de la tab
            if (tabId === "carwash-historial") {
              loadCarwashHistory();
            } else if (tabId === "barberia-historial") {
              loadBarberiaHistory();
            } else if (tabId === "carwash-entregados") {
              loadCompletedVehicles();
            }
          });
        });

        // Config tabs
        document.querySelectorAll(".config-tab").forEach((tab) => {
          tab.addEventListener("click", function () {
            const tabId = this.getAttribute("data-config-tab");

            this.parentElement.querySelectorAll(".config-tab").forEach((t) => {
              t.classList.remove("active");
            });

            this.classList.add("active");

            document
              .querySelectorAll("#config-servicios .tab-content")
              .forEach((content) => {
                content.classList.remove("active");
              });

            const targetContent = document.getElementById(tabId);
            if (targetContent) {
              targetContent.classList.add("active");
            }
          });
        });

        // Tema toggle
        document
          .getElementById("themeToggle")
          .addEventListener("click", function () {
            if (document.body.classList.contains("dark-mode")) {
              document.body.classList.remove("dark-mode");
              document.body.classList.add("light-mode");
              this.innerHTML = '<i class="fas fa-sun"></i>';
              localStorage.setItem("stark_theme", "light");
            } else {
              document.body.classList.remove("light-mode");
              document.body.classList.add("dark-mode");
              this.innerHTML = '<i class="fas fa-moon"></i>';
              localStorage.setItem("stark_theme", "dark");
            }
          });

        // Hamburger menu
        document
          .querySelector(".hamburger")
          .addEventListener("click", function () {
            document.querySelector(".sidebar").classList.toggle("active");
          });

        // Logout
        document
          .getElementById("logoutBtn")
          .addEventListener("click", function () {
            if (confirm("¿Estás seguro de cerrar sesión?")) {
              document.getElementById("screen-login").style.display = "flex";
              document.getElementById("mainSystem").style.display = "none";

              // Limpiar carritos
              cart = [];
              cartBarberia = [];
              cartCarwash = [];

              showNotification("Sesión cerrada correctamente", "success");
            }
          });

        // Dashboard cards
        document.addEventListener("click", function (event) {
          if (event.target.closest(".card-system")) {
            const card = event.target.closest(".card-system");
            const pageId = card.getAttribute("data-page");
            if (pageId) {
              showPage(pageId);
            }
          }
        });

        // Campos de pago
        document
          .getElementById("efectivo-recibido")
          ?.addEventListener("input", updateChange);
        document
          .getElementById("efectivo-recibido-barberia")
          ?.addEventListener("input", updateChangeBarberia);
        document
          .getElementById("efectivo-recibido-carwash")
          ?.addEventListener("input", updateChangeCarwash);

        // Métodos de pago (mostrar/ocultar aprobación)
        document
          .getElementById("metodo-pago")
          ?.addEventListener("change", function () {
            document.getElementById("approvalField").style.display =
              this.value === "tarjeta" ? "block" : "none";
          });

        document
          .getElementById("metodo-pago-barberia")
          ?.addEventListener("change", function () {
            document.getElementById("approvalFieldBarberia").style.display =
              this.value === "tarjeta" ? "block" : "none";
          });

        document
          .getElementById("metodo-pago-carwash")
          ?.addEventListener("change", function () {
            document.getElementById("approvalFieldCarwash").style.display =
              this.value === "tarjeta" ? "block" : "none";
          });

        // Botones de confirmar venta
        document
          .getElementById("confirmSaleBtn")
          ?.addEventListener("click", function () {
            if (cart.length === 0) {
              showNotification("El carrito está vacío", "error");
              return;
            }

            const total = getCartTotal();
            const metodoPago = document.getElementById("metodo-pago").value;
            const rnc = document.getElementById("rnc").value.trim();
            const aprobacion = document
              .getElementById("aprobacion")
              .value.trim();
            const efectivoRecibido =
              parseFloat(document.getElementById("efectivo-recibido").value) ||
              0;

            if (metodoPago === "efectivo" && efectivoRecibido < total) {
              showNotification("El efectivo recibido es insuficiente", "error");
              return;
            }

            if (metodoPago === "tarjeta" && !aprobacion) {
              showNotification("Ingrese el número de aprobación", "error");
              return;
            }

            const invoiceNumber = printInvoice("billar", cart, total, {
              rnc: rnc,
              metodo_pago: metodoPago,
              aprobacion: aprobacion,
            });

            showNotification(`Venta confirmada #${invoiceNumber}`, "success");
          });

        document
          .getElementById("confirmSaleBtnBarberia")
          ?.addEventListener("click", function () {
            if (cartBarberia.length === 0) {
              showNotification("El carrito está vacío", "error");
              return;
            }

            const total = getCartTotalBarberia();
            const cliente =
              document.getElementById("cliente-barberia").value.trim() ||
              "Cliente no registrado";
            const metodoPago = document.getElementById(
              "metodo-pago-barberia"
            ).value;
            const rnc = document.getElementById("rnc-barberia").value.trim();
            const aprobacion = document
              .getElementById("aprobacion-barberia")
              .value.trim();
            const efectivoRecibido =
              parseFloat(
                document.getElementById("efectivo-recibido-barberia").value
              ) || 0;

            if (metodoPago === "efectivo" && efectivoRecibido < total) {
              showNotification("El efectivo recibido es insuficiente", "error");
              return;
            }

            if (metodoPago === "tarjeta" && !aprobacion) {
              showNotification("Ingrese el número de aprobación", "error");
              return;
            }

            const invoiceNumber = printInvoice(
              "barberia",
              cartBarberia,
              total,
              {
                cliente: cliente,
                rnc: rnc,
                metodo_pago: metodoPago,
                aprobacion: aprobacion,
              }
            );

            showNotification(`Venta confirmada #${invoiceNumber}`, "success");
          });

        document
          .getElementById("confirmSaleBtnCarwash")
          ?.addEventListener("click", function () {
            if (cartCarwash.length === 0) {
              showNotification("El carrito está vacío", "error");
              return;
            }

            const total = getCartTotalCarwash();
            const vehiculo = document.getElementById("vehiculo-servicio").value;
            const metodoPago = document.getElementById(
              "metodo-pago-carwash"
            ).value;
            const rnc = document.getElementById("rnc-carwash").value.trim();
            const aprobacion = document
              .getElementById("aprobacion-carwash")
              .value.trim();
            const efectivoRecibido =
              parseFloat(
                document.getElementById("efectivo-recibido-carwash").value
              ) || 0;

            if (metodoPago === "efectivo" && efectivoRecibido < total) {
              showNotification("El efectivo recibido es insuficiente", "error");
              return;
            }

            if (metodoPago === "tarjeta" && !aprobacion) {
              showNotification("Ingrese el número de aprobación", "error");
              return;
            }

            const invoiceNumber = printInvoice("carwash", cartCarwash, total, {
              vehiculo: vehiculo,
              rnc: rnc,
              metodo_pago: metodoPago,
              aprobacion: aprobacion,
            });

            showNotification(`Venta confirmada #${invoiceNumber}`, "success");
          });

        // Botones de imprimir ticket
        document
          .getElementById("printTicketBtn")
          ?.addEventListener("click", function () {
            if (cart.length === 0) {
              showNotification("El carrito está vacío", "error");
              return;
            }
            printInvoice("billar", cart, getCartTotal());
          });

        document
          .getElementById("printTicketBtnBarberia")
          ?.addEventListener("click", function () {
            if (cartBarberia.length === 0) {
              showNotification("El carrito está vacío", "error");
              return;
            }
            printInvoice("barberia", cartBarberia, getCartTotalBarberia());
          });

        document
          .getElementById("printTicketBtnCarwash")
          ?.addEventListener("click", function () {
            if (cartCarwash.length === 0) {
              showNotification("El carrito está vacío", "error");
              return;
            }
            printInvoice("carwash", cartCarwash, getCartTotalCarwash());
          });

        // Botones de limpiar carrito
        document
          .getElementById("clearCartBtn")
          ?.addEventListener("click", function () {
            cart = [];
            updateCartUI();
            showNotification("Carrito limpiado", "success");
          });

        // Búsqueda de productos
        document
          .getElementById("search-product")
          ?.addEventListener("input", function () {
            const searchTerm = this.value.toLowerCase();
            const products = DB.get("productos");
            const container = document.getElementById("billar-products-touch");

            if (!container) return;

            const filtered = products.filter(
              (product) =>
                product.nombre.toLowerCase().includes(searchTerm) ||
                product.codigo?.toLowerCase().includes(searchTerm) ||
                product.categoria.toLowerCase().includes(searchTerm)
            );

            TouchSystem.loadTouchServices(
              "billar-products-touch",
              filtered.filter((p) => p.stock > 0),
              "product"
            );
          });

        // Cerrar modales
        document
          .getElementById("closeInvoiceModal")
          ?.addEventListener("click", function () {
            document.getElementById("invoiceModal").classList.remove("active");
          });

        document
          .getElementById("closeProductModal")
          ?.addEventListener("click", function () {
            document.getElementById("productModal").classList.remove("active");
            // Restaurar el botón de guardar a la función por defecto
            const saveBtn = document.getElementById("saveProductBtn");
            saveBtn.innerHTML = '<i class="fas fa-save"></i> Guardar Producto';
            saveBtn.onclick = function () {
              // Función por defecto para nuevo producto
            };
          });

        // Guardar tema
        document
          .getElementById("saveThemeBtn")
          ?.addEventListener("click", function () {
            const tema = document.getElementById("select-tema").value;
            localStorage.setItem("stark_theme", tema);

            if (tema === "light") {
              document.body.classList.remove("dark-mode");
              document.body.classList.add("light-mode");
              document.getElementById("themeToggle").innerHTML =
                '<i class="fas fa-sun"></i>';
            } else {
              document.body.classList.remove("light-mode");
              document.body.classList.add("dark-mode");
              document.getElementById("themeToggle").innerHTML =
                '<i class="fas fa-moon"></i>';
            }

            showNotification("Tema actualizado", "success");
          });

        // Cargar tema guardado
        const savedTheme = localStorage.getItem("stark_theme") || "dark";
        if (savedTheme === "light") {
          document.body.classList.remove("dark-mode");
          document.body.classList.add("light-mode");
          document.getElementById("themeToggle").innerHTML =
            '<i class="fas fa-sun"></i>';
          document.getElementById("select-tema").value = "light";
        }

        // Actualizar dashboard
        document
          .getElementById("refreshDashboard")
          ?.addEventListener("click", function () {
            updateDashboard();
            showNotification("Dashboard actualizado", "success");
          });

        // Botón de nuevo producto (abrir modal)
        document
          .getElementById("newProductBtn")
          ?.addEventListener("click", function () {
            // Limpiar formulario
            document.getElementById("nombre-producto").value = "";
            document.getElementById("codigo-barra-producto").value = "";
            document.getElementById("categoria-producto").value = "";
            document.getElementById("precio-compra").value = "";
            document.getElementById("precio-venta").value = "";
            document.getElementById("cantidad-stock").value = "";
            document.getElementById("alerta-stock").value = "5";

            // Restaurar botón de guardar
            const saveBtn = document.getElementById("saveProductBtn");
            saveBtn.innerHTML = '<i class="fas fa-save"></i> Guardar Producto';
            saveBtn.onclick = function () {
              saveNewProduct();
            };

            // Mostrar modal
            document.getElementById("productModal").classList.add("active");
          });

        // Botón de agregar producto desde modal
        function saveNewProduct() {
          const nombre = document
            .getElementById("nombre-producto")
            .value.trim();
          const codigo = document
            .getElementById("codigo-barra-producto")
            .value.trim();
          const categoria = document.getElementById("categoria-producto").value;
          const precioCompra = parseFloat(
            document.getElementById("precio-compra").value
          );
          const precioVenta = parseFloat(
            document.getElementById("precio-venta").value
          );
          const stock = parseInt(
            document.getElementById("cantidad-stock").value
          );
          const alertaStock = parseInt(
            document.getElementById("alerta-stock").value
          );

          if (!nombre || !categoria || !precioCompra || !precioVenta) {
            showNotification("Complete los campos requeridos", "error");
            return;
          }

          const newProduct = {
            id: Date.now(),
            nombre: nombre,
            codigo: codigo || null,
            categoria: categoria,
            precio_compra: precioCompra,
            precio_venta: precioVenta,
            stock: stock || 0,
            alerta_stock: alertaStock || 5,
          };

          DB.add("productos", newProduct);
          showNotification("Producto guardado exitosamente", "success");

          // Cerrar modal
          document.getElementById("productModal").classList.remove("active");

          // Actualizar listas
          loadConfigProducts();
          loadBillarProducts();
        }

        // Asignar la función al botón de guardar producto
        document.getElementById("saveProductBtn").onclick = saveNewProduct;

        // Botón de nueva cita
        document
          .getElementById("newAppointmentBtn")
          ?.addEventListener("click", function () {
            showPage("barberia");
            // Activar la pestaña de citas
            document.querySelector('[data-tab="barberia-citas"]').click();
          });

        // Botón de registrar vehículo
        document
          .getElementById("newVehicleBtn")
          ?.addEventListener("click", function () {
            showPage("carwash");
            // Activar la pestaña de registro
            document.querySelector('[data-tab="carwash-registro"]').click();
          });
      }

      // =============================================
      // SISTEMA DE DASHBOARD
      // =============================================

      function updateDashboard() {
        // Obtener fecha actual
        const today = new Date().toISOString().split("T")[0];

        // Obtener datos
        const appointments = DB.get("barberia_appointments");
        const billarSales = DB.get("billar_sales");
        const barberiaSales = DB.get("barberia_sales");
        const carwashSales = DB.get("carwash_sales");
        const vehicles = DB.get("carwash_vehicles");

        // Filtrar datos de hoy
        const todayAppointments = appointments.filter(
          (a) => a.fecha?.split("T")[0] === today
        );
        const todayBillarSales = billarSales.filter(
          (s) => s.fecha?.split("T")[0] === today
        );
        const todayBarberiaSales = barberiaSales.filter(
          (s) => s.fecha?.split("T")[0] === today
        );
        const todayCarwashSales = carwashSales.filter(
          (s) => s.fecha?.split("T")[0] === today
        );
        const todayVehicles = vehicles.filter(
          (v) => v.entrada?.split("T")[0] === today
        );

        // Calcular totales
        const totalBillar = todayBillarSales.reduce(
          (sum, sale) => sum + sale.total,
          0
        );
        const totalBarberia = todayBarberiaSales.reduce(
          (sum, sale) => sum + sale.total,
          0
        );
        const totalCarwash = todayCarwashSales.reduce(
          (sum, sale) => sum + sale.total,
          0
        );
        const totalDaily = totalBillar + totalBarberia + totalCarwash;

        const totalCustomers = new Set([
          ...todayBillarSales.map((s) => s.cliente),
          ...todayBarberiaSales.map((s) => s.cliente),
          ...todayCarwashSales.map((s) => s.cliente),
        ]).size;

        const totalProductsSold = todayBillarSales.reduce(
          (sum, sale) =>
            sum +
            sale.items.reduce(
              (itemSum, item) => itemSum + (item.quantity || 1),
              0
            ),
          0
        );

        // Actualizar UI
        document.getElementById("appointmentsCount").textContent =
          todayAppointments.length;
        document.getElementById("appointmentsTrend").textContent =
          todayAppointments.length > 0
            ? `${todayAppointments.length} citas hoy`
            : "No hay citas hoy";

        document.getElementById(
          "salesTotal"
        ).textContent = `RD$ ${totalBillar}`;
        document.getElementById("salesTrend").textContent =
          todayBillarSales.length > 0
            ? `${todayBillarSales.length} ventas hoy`
            : "No hay ventas hoy";

        document.getElementById("vehiclesCount").textContent =
          todayVehicles.length;
        document.getElementById("vehiclesTrend").textContent =
          todayVehicles.length > 0
            ? `${todayVehicles.length} vehículos hoy`
            : "No hay vehículos hoy";

        document.getElementById(
          "dailyIncome"
        ).textContent = `RD$ ${totalDaily}`;
        document.getElementById("incomeTrend").textContent =
          totalDaily > 0 ? `Total del día` : "Sin ingresos hoy";

        document.getElementById("customersCount").textContent = totalCustomers;
        document.getElementById("customersTrend").textContent =
          totalCustomers > 0
            ? `${totalCustomers} clientes atendidos`
            : "Sin clientes hoy";

        document.getElementById("productsSold").textContent = totalProductsSold;
        document.getElementById("productsTrend").textContent =
          totalProductsSold > 0
            ? `${totalProductsSold} productos vendidos`
            : "Sin productos vendidos";

        // Actualizar gráfico
        updateSalesChart();
      }

      function updateSalesChart() {
        const ctx = document.getElementById("salesChart");
        if (!ctx) return;

        // Obtener ventas de los últimos 7 días
        const dates = [];
        const salesData = [];

        for (let i = 6; i >= 0; i--) {
          const date = new Date();
          date.setDate(date.getDate() - i);
          const dateString = date.toISOString().split("T")[0];
          dates.push(date.toLocaleDateString("es-ES", { weekday: "short" }));

          const billarSales = DB.get("billar_sales").filter(
            (s) => s.fecha?.split("T")[0] === dateString
          );
          const barberiaSales = DB.get("barberia_sales").filter(
            (s) => s.fecha?.split("T")[0] === dateString
          );
          const carwashSales = DB.get("carwash_sales").filter(
            (s) => s.fecha?.split("T")[0] === dateString
          );

          const total =
            billarSales.reduce((sum, s) => sum + s.total, 0) +
            barberiaSales.reduce((sum, s) => sum + s.total, 0) +
            carwashSales.reduce((sum, s) => sum + s.total, 0);

          salesData.push(total);
        }

        // Crear o actualizar gráfico
        if (window.salesChartInstance) {
          window.salesChartInstance.data.labels = dates;
          window.salesChartInstance.data.datasets[0].data = salesData;
          window.salesChartInstance.update();
        } else {
          window.salesChartInstance = new Chart(ctx, {
            type: "line",
            data: {
              labels: dates,
              datasets: [
                {
                  label: "Ventas (RD$)",
                  data: salesData,
                  borderColor: "var(--primary)",
                  backgroundColor: "rgba(26, 115, 232, 0.1)",
                  borderWidth: 2,
                  fill: true,
                  tension: 0.4,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  display: false,
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  grid: {
                    color: "var(--border-color)",
                  },
                  ticks: {
                    color: "var(--text-color)",
                  },
                },
                x: {
                  grid: {
                    color: "var(--border-color)",
                  },
                  ticks: {
                    color: "var(--text-color)",
                  },
                },
              },
            },
          });
        }
      }

      // =============================================
      // JARVIS AI ASSISTANT
      // =============================================

      class JarvisAI {
        constructor() {
          this.isListening = false;
          this.recognition = null;
          this.init();
        }

        init() {
          this.setupChat();
        }

        setupChat() {
          const jarvisButton = document.getElementById("jarvisButton");
          const jarvisChat = document.getElementById("jarvisChat");
          const closeJarvis = document.getElementById("closeJarvis");
          const sendJarvis = document.getElementById("sendJarvis");
          const jarvisInput = document.getElementById("jarvisInput");

          jarvisButton.addEventListener("click", () => {
            jarvisChat.classList.toggle("active");
          });

          closeJarvis.addEventListener("click", () => {
            jarvisChat.classList.remove("active");
          });

          sendJarvis.addEventListener("click", () => {
            const message = jarvisInput.value.trim();
            if (message) {
              this.addMessage(message, "user");
              this.processCommand(message);
              jarvisInput.value = "";
            }
          });

          jarvisInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
              sendJarvis.click();
            }
          });
        }

        addMessage(text, sender) {
          const messagesContainer = document.getElementById("jarvisMessages");
          const message = document.createElement("div");
          message.className = `message ${sender}`;
          message.textContent = text;
          messagesContainer.appendChild(message);
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        processCommand(command) {
          this.addMessage(command, "user");

          // Primero verificar comandos personalizados
          if (JarvisCommandsSystem.executeCommand(command)) {
            return;
          }

          // Comandos predefinidos
          const lowerCommand = command.toLowerCase();

          if (lowerCommand.includes("abrir") || lowerCommand.includes("ir a")) {
            this.processOpenCommand(lowerCommand);
          } else if (
            lowerCommand.includes("registrar cita") ||
            lowerCommand.includes("nueva cita")
          ) {
            this.processAppointmentCommand(lowerCommand);
          } else if (
            lowerCommand.includes("registrar vehículo") ||
            lowerCommand.includes("nuevo vehículo")
          ) {
            this.processVehicleCommand(lowerCommand);
          } else if (
            lowerCommand.includes("resumen") ||
            lowerCommand.includes("reporte")
          ) {
            this.showDailySummary();
          } else if (
            lowerCommand.includes("inventario") ||
            lowerCommand.includes("stock")
          ) {
            this.showInventory();
          } else if (lowerCommand.includes("buscar")) {
            this.processSearchCommand(lowerCommand);
          } else if (
            lowerCommand.includes("ayuda") ||
            lowerCommand.includes("comandos")
          ) {
            this.showHelp();
          } else {
            this.addMessage(
              "No entendí el comando. Intenta decir 'ayuda' para ver los comandos disponibles.",
              "jarvis"
            );
          }
        }

        processOpenCommand(command) {
          if (command.includes("dashboard") || command.includes("inicio")) {
            showPage("dashboard");
            this.addMessage("Abriendo Dashboard...", "jarvis");
          } else if (
            command.includes("barbería") ||
            command.includes("barberia")
          ) {
            showPage("barberia");
            this.addMessage("Abriendo Barbería...", "jarvis");
          } else if (command.includes("billar") || command.includes("pos")) {
            showPage("billar");
            this.addMessage("Abriendo Billar POS...", "jarvis");
          } else if (
            command.includes("car wash") ||
            command.includes("carwash")
          ) {
            showPage("carwash");
            this.addMessage("Abriendo Car Wash...", "jarvis");
          } else if (
            command.includes("configuración") ||
            command.includes("configuracion")
          ) {
            showPage("config-servicios");
            this.addMessage("Abriendo Configuración...", "jarvis");
          } else {
            this.addMessage(
              "¿A qué módulo te refieres? Puedo abrir: Dashboard, Barbería, Billar, Car Wash o Configuración.",
              "jarvis"
            );
          }
        }

        processAppointmentCommand(command) {
          this.addMessage(
            "Función de registro de citas por voz en desarrollo...",
            "jarvis"
          );
          showPage("barberia");
          document.querySelector('[data-tab="barberia-citas"]').click();
        }

        processVehicleCommand(command) {
          this.addMessage(
            "Función de registro de vehículos por voz en desarrollo...",
            "jarvis"
          );
          showPage("carwash");
          document.querySelector('[data-tab="carwash-registro"]').click();
        }

        processSearchCommand(command) {
          const searchTerm = command.replace("buscar", "").trim();
          if (searchTerm) {
            this.addMessage(`Buscando: "${searchTerm}"...`, "jarvis");

            // Buscar en productos
            const products = DB.get("productos");
            const foundProducts = products.filter(
              (p) =>
                p.nombre.toLowerCase().includes(searchTerm) ||
                p.codigo?.toLowerCase().includes(searchTerm)
            );

            if (foundProducts.length > 0) {
              this.addMessage(
                `Encontré ${foundProducts.length} producto(s):`,
                "jarvis"
              );
              foundProducts.forEach((p) => {
                this.addMessage(
                  `- ${p.nombre} (Stock: ${p.stock}, Precio: RD$ ${p.precio_venta})`,
                  "jarvis"
                );
              });
            } else {
              this.addMessage(
                "No encontré productos con ese término.",
                "jarvis"
              );
            }
          } else {
            this.addMessage(
              "¿Qué te gustaría buscar? Ejemplo: 'buscar refresco'",
              "jarvis"
            );
          }
        }

        showDailySummary() {
          updateDashboard();
          this.addMessage("Mostrando resumen del día...", "jarvis");
          showPage("dashboard");
        }

        showInventory() {
          const products = DB.get("productos");
          const lowStock = products.filter((p) => p.stock <= 5);

          this.addMessage(`Inventario actual:`, "jarvis");
          this.addMessage(`- Total productos: ${products.length}`, "jarvis");
          this.addMessage(
            `- Productos con bajo stock: ${lowStock.length}`,
            "jarvis"
          );

          if (lowStock.length > 0) {
            this.addMessage("Productos con stock bajo:", "jarvis");
            lowStock.forEach((p) => {
              this.addMessage(`- ${p.nombre}: ${p.stock} unidades`, "jarvis");
            });
          }

          showPage("billar");
          document.querySelector('[data-tab="billar-inventario"]').click();
        }

        showHelp() {
          this.addMessage("Comandos disponibles:", "jarvis");
          this.addMessage(
            "- 'Abrir [módulo]': Navega a cualquier módulo",
            "jarvis"
          );
          this.addMessage("- 'Registrar cita': Crea una nueva cita", "jarvis");
          this.addMessage(
            "- 'Registrar vehículo': Registra un nuevo vehículo",
            "jarvis"
          );
          this.addMessage(
            "- 'Resumen del día': Muestra el reporte diario",
            "jarvis"
          );
          this.addMessage(
            "- 'Buscar [producto]': Busca productos en inventario",
            "jarvis"
          );
          this.addMessage(
            "- 'Ver inventario': Muestra el estado del inventario",
            "jarvis"
          );
          this.addMessage(
            "- 'Ayuda': Muestra esta lista de comandos",
            "jarvis"
          );
        }
      }

      // =============================================
      // INICIALIZACIÓN DE LA APLICACIÓN
      // =============================================

      function initApp() {
        // Inicializar datos
        DB.initializeData();

        // Inicializar sistemas
        TouchSystem.init();
        JarvisCommandsSystem.init();

        // Configurar event listeners
        setupEventListeners();

        // Inicializar Jarvis AI
        window.jarvis = new JarvisAI();

        // Cargar datos iniciales
        loadBarberiaServices();
        loadCarwashServices();
        loadBillarProducts();
        loadConfigServices();
        loadConfigProducts();
        loadConfigUsers();
        loadConfigEmployees();

        // Asignar funciones a los botones
        document.getElementById("agregar-servicio-barberia").onclick =
          addNewBarberiaService;
        document.getElementById("agregar-servicio-carwash").onclick =
          addNewCarwashService;
        document.getElementById("agregar-producto").onclick = addNewProduct;
        document.getElementById("saveEmployeeBtn").onclick = addNewEmployee;
        document.getElementById("saveVehicleBtn").onclick = saveVehicle;
        document.getElementById("saveAppointmentBtn").onclick = saveAppointment;

        // Configurar guardar configuración Jarvis
        document.getElementById("saveJarvisConfigBtn").onclick = function () {
          showNotification("Configuración Jarvis guardada", "success");
        };

        // Configurar guardar configuración impresora
        document.getElementById("savePrinterConfigBtn").onclick = function () {
          const companyName = document.getElementById("company-name").value;
          const companyAddress =
            document.getElementById("company-address").value;
          const companyPhone = document.getElementById("company-phone").value;
          const companyRNC = document.getElementById("company-rnc").value;
          const paperWidth = document.getElementById("paper-width").value;

          localStorage.setItem("company_name", companyName);
          localStorage.setItem("company_address", companyAddress);
          localStorage.setItem("company_phone", companyPhone);
          localStorage.setItem("company_rnc", companyRNC);
          localStorage.setItem("paper_width", paperWidth);

          showNotification("Configuración de impresora guardada", "success");
        };

        // Cargar configuración de impresora
        document.getElementById("company-name").value =
          localStorage.getItem("company_name") || "STARK CLEANE";
        document.getElementById("company-address").value =
          localStorage.getItem("company_address") || "";
        document.getElementById("company-phone").value =
          localStorage.getItem("company_phone") || "";
        document.getElementById("company-rnc").value =
          localStorage.getItem("company_rnc") || "133577461";
        document.getElementById("paper-width").value =
          localStorage.getItem("paper_width") || "82";

        // Actualizar dashboard
        updateDashboard();
      }

      // =============================================
      // FUNCIONES ADICIONALES
      // =============================================

      function loadCarwashVehicles() {
        const vehicles = DB.get("carwash_vehicles");
        const grid = document.getElementById("vehiclesGrid");
        const select = document.getElementById("vehiculo-servicio");

        if (grid) {
          grid.innerHTML = "";

          // Filtrar vehículos en proceso
          const vehiclesInProcess = vehicles.filter(
            (v) => v.estado === "en_proceso"
          );

          if (vehiclesInProcess.length === 0) {
            grid.innerHTML = `
                        <div style="text-align: center; padding: 40px; width: 100%; color: var(--text-secondary);">
                            <i class="fas fa-car" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3>No hay vehículos en proceso</h3>
                            <p>Registra un nuevo vehículo para comenzar</p>
                        </div>
                    `;
          } else {
            vehiclesInProcess.forEach((vehicle) => {
              const card = document.createElement("div");
              card.className = "vehicle-card";
              card.innerHTML = `
                            <div class="vehicle-header">
                                <div class="vehicle-placa">${
                                  vehicle.placa
                                }</div>
                                <span class="vehicle-type ${vehicle.tipo}">${
                vehicle.tipo
              }</span>
                            </div>
                            <div class="vehicle-details">
                                <div class="vehicle-detail">
                                    <span>Cliente:</span>
                                    <span>${vehicle.cliente}</span>
                                </div>
                                <div class="vehicle-detail">
                                    <span>Teléfono:</span>
                                    <span>${
                                      vehicle.telefono || "No especificado"
                                    }</span>
                                </div>
                                <div class="vehicle-detail">
                                    <span>Empleado:</span>
                                    <span>${vehicle.empleado}</span>
                                </div>
                                <div class="vehicle-time">
                                    <i class="fas fa-clock"></i>
                                    <span>Entrada: ${new Date(
                                      vehicle.entrada
                                    ).toLocaleTimeString()}</span>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="addServicesToVehicle(${
                                  vehicle.id
                                })">
                                    <i class="fas fa-plus"></i> Agregar Servicios
                                </button>
                                <button class="btn btn-success" onclick="completeVehicle(${
                                  vehicle.id
                                })">
                                    <i class="fas fa-check"></i> Completar
                                </button>
                            </div>
                        `;
              grid.appendChild(card);
            });
          }
        }

        if (select) {
          select.innerHTML = '<option value="">Seleccione vehículo</option>';
          const activeVehicles = vehicles.filter(
            (v) => v.estado === "en_proceso"
          );
          activeVehicles.forEach((vehicle) => {
            const option = document.createElement("option");
            option.value = vehicle.id;
            option.textContent = `${vehicle.placa} - ${vehicle.cliente}`;
            select.appendChild(option);
          });
        }
      }

      function addServicesToVehicle(vehicleId) {
        // Navegar a la pestaña de servicios
        showPage("carwash");
        document.querySelector('[data-tab="carwash-servicios"]').click();

        // Seleccionar el vehículo en el select
        const select = document.getElementById("vehiculo-servicio");
        if (select) {
          select.value = vehicleId;
        }

        showNotification("Selecciona los servicios para este vehículo", "info");
      }

      function completeVehicle(vehicleId) {
        const vehicles = DB.get("carwash_vehicles");
        const vehicleIndex = vehicles.findIndex((v) => v.id === vehicleId);

        if (vehicleIndex !== -1) {
          vehicles[vehicleIndex].estado = "completado";
          vehicles[vehicleIndex].salida = new Date().toISOString();
          DB.set("carwash_vehicles", vehicles);
          showNotification("Vehículo marcado como completado", "success");
          loadCarwashVehicles();
          loadCompletedVehicles();
        }
      }

      // =============================================
      // INICIALIZACIÓN AL CARGAR LA PÁGINA
      // =============================================

      // Ya configurado en DOMContentLoaded
    </script>
  </body>
</html>
